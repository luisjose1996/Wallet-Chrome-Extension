var SharedCoin=new function(){var c=this;var b=120000;var f=3;var k=0;var j=120000;var l={};var h=3;var i=MyWallet.getSharedcoinEndpoint()+"?version="+h;var e={};var a="sharedcoin-seed:";(function(m){m.retryAjax=function(o){var n;o.tryCount=(!o.tryCount)?0:o.tryCount;o.retryLimit=(!o.retryLimit)?2:o.retryLimit;o.suppressErrors=true;if(o.error){n=o.error;delete o.error}else{n=function(){}}o.complete=function(p,q){if(m.inArray(q,["timeout","abort","error"])>-1){this.tryCount++;if(this.tryCount<=this.retryLimit){if(this.tryCount===this.retryLimit){this.error=n;delete this.suppressErrors}m.ajax(this);return true}return true}};m.ajax(o)}}(jQuery));Bitcoin.Transaction.deserialize=function(v){function n(E){var C,D;C=E.splice(0,1)[0];if(C<253){D=[C]}else{if(C==253){D=E.splice(0,2)}else{if(C==254){D=E.splice(0,4)}else{D=E.splice(0,8)}}}return BigInteger.fromByteArrayUnsigned(D)}function y(C){return new BigInteger(C.splice(0,4).reverse()).intValue()}var x=new Bitcoin.Transaction();x.version=y(v);var r=n(v).intValue();for(var w=0;w<r;w++){var s=v.splice(0,32);var p=Crypto.util.bytesToBase64(s);var m=y(v);var u=n(v).intValue();var z=new Bitcoin.Script(v.splice(0,u));var q=y(v);var A=new Bitcoin.TransactionIn({outpoint:{hash:p,index:m},script:z,sequence:q});x.ins.push(A)}var B=n(v).intValue();for(var w=0;w<B;w++){var o=v.splice(0,8);var u=n(v).intValue();var z=new Bitcoin.Script(v.splice(0,u));var t=new Bitcoin.TransactionOut({script:z,value:o});x.outs.push(t)}x.lock_time=y(v);return x};function g(r,u){var s=[];var m=Math.round(r*1/u);var t=Math.round(0.5*m);var p=0;for(var o=0;o<u;o++){var q=Math.floor((Math.random()*m)+t);if(p+q>r||o==u-1){q=r-p}p+=q;s[o]=q;if(p==r){break}}return s}var d={show:function(){var m=this;m.modal=$("#sharedcoin-modal");m.modal.modal({keyboard:false,backdrop:"static",show:true});m.modal.find(".btn.btn-secondary").unbind().click(function(){m.hide()})},setAddressAndAmount:function(m,n){if(this.modal){this.modal.find(".total_value").text(formatBTC(n));this.modal.find(".address").text(m)}},hide:function(){if(this.modal){this.modal.modal("hide")}},disableCancel:function(){if(this.modal){this.modal.find(".alert-warning").show();this.modal.find(".alert-error").hide();this.modal.find(".btn.btn-secondary").prop("disabled",true)}},enableCancel:function(){if(this.modal){this.modal.find(".alert-error").show();this.modal.find(".alert-warning").hide();this.modal.find(".btn.btn-secondary").prop("disabled",false)}}};this.newProposal=function(){return{_pollForCompleted:function(o,n){var m=this;console.log("Offer._pollForCompleted()");MyWallet.setLoadingText("Waiting For Other Participants To Sign");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:4,data:{method:"poll_for_proposal_completed",format:"json",proposal_id:m.proposal_id},success:function(p){o(p)},error:function(p){n(p.responseText)}})},pollForCompleted:function(p,n){var m=this;var o=function(q){if(q.status=="waiting"){m._pollForCompleted(o,n)}else{if(q.status=="not_found"){n("Proposal ID Not Found")}else{if(q.status=="complete"){p(q.tx_hash,q.tx)}else{n("Unknown status "+q.status)}}}};m._pollForCompleted(o,n)}}};this.newOffer=function(){return{offered_outpoints:[],request_outputs:[],offer_id:0,submit:function(p,o,m){var n=this;MyWallet.setLoadingText("Submitting Offer");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:f,data:{method:"submit_offer",format:"json",token:c.getToken(),offer:JSON.stringify(n)},success:function(q){if(q.status=="complete"){m(q.tx_hash,q.tx)}else{if(!q.offer_id){o("Null offer_id returned")}else{n.offer_id=q.offer_id;p()}}},error:function(q){o(q.responseText)}})},_pollForProposalID:function(o,n){var m=this;console.log("Offer._pollForProposalID()");MyWallet.setLoadingText("Waiting For Other Participants");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:f,data:{method:"get_offer_id",format:"json",offer_id:m.offer_id},success:function(p){o(p)},error:function(p){n(p.responseText)}})},calculateFee:function(){var m=this;var p=BigInteger.ZERO;for(var n in m.offered_outpoints){p=p.add(BigInteger.valueOf(m.offered_outpoints[n].value))}var o=BigInteger.ZERO;for(var n in m.request_outputs){o=o.add(BigInteger.valueOf(m.request_outputs[n].value))}return p.subtract(o)},pollForProposalID:function(p,n){var m=this;var o=function(q){if(q.status=="waiting"){m._pollForProposalID(o,n)}else{if(q.status=="not_found"){n("Offer ID Not Found")}else{if(q.status=="active_proposal"){p(q.proposal_id)}else{n("Unknown status "+q.status)}}}};m._pollForProposalID(o,n)},getProposal:function(p,q,o,m){var n=this;console.log("SharedCoin.getProposal()");MyWallet.setLoadingText("Fetching Proposal");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:f,data:{method:"get_proposal_id",format:"json",offer_id:n.offer_id,proposal_id:p},success:function(s){var r=c.newProposal();var t=jQuery.extend(r,s);if(t.status=="not_found"){o("Proposal or Offer ID Not Found")}else{if(t.status=="complete"){m(t.tx_hash,t.tx)}else{if(t.status=="signatures_needed"){q(t)}}}},error:function(r){o(r.responseText)}})},isOutpointOneWeOffered:function(n){var m=this;var p=n.outpoint.hash;var s=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(p).reverse());var o=n.outpoint.index;for(var q in m.offered_outpoints){var r=m.offered_outpoints[q];if(r.hash.toString()==s.toString()&&r.index.toString()==o.toString()){return true}}return false},isOutputOneWeRequested:function(o){var n=this;var s=o.value.slice(0);s.reverse();var m=Crypto.util.bytesToHex(o.script.buffer);var r=new BigInteger(s);for(var p in n.request_outputs){var q=n.request_outputs[p];if(q.script.toString()==m.toString()&&r.toString()==q.value.toString()){return true}}return false},isOutputChange:function(o){var n=this;var s=o.value.slice(0);s.reverse();var m=Crypto.util.bytesToHex(o.script.buffer);var r=new BigInteger(s);for(var p in n.request_outputs){var q=n.request_outputs[p];if(q.script.toString()==m.toString()&&r.toString()==q.value.toString()){return q.exclude_from_fee}}return false},determineOutputsToOfferNextStage:function(s,w,t){var x=this;try{var n=Crypto.util.hexToBytes(s);var p=Bitcoin.Transaction.deserialize(n);var u=[];for(var o=0;o<p.outs.length;++o){var m=p.outs[o];if(x.isOutputOneWeRequested(m)){if(!x.isOutputChange(m)){var r=m.value.slice(0);r.reverse();var v=new BigInteger(r);u.push({hash:null,index:parseInt(o),value:v.toString()})}}}w(u)}catch(q){t(q)}},checkProposal:function(t,v,u){console.log("Offer.checkProposal()");var x=this;try{if(t.tx==null){throw"Proposal Transaction Is Null"}var p=Crypto.util.hexToBytes(t.tx);var r=Bitcoin.Transaction.deserialize(p);if(r==null){throw"Error deserializing transaction"}var w=0;for(var q=0;q<r.outs.length;++q){var o=r.outs[q];if(x.isOutputOneWeRequested(o)){++w}}if(w<x.request_outputs.length){throw"Could not find all our requested outputs ("+w+" < "+x.request_outputs.length+")"}var n=0;for(var q=0;q<t.signature_requests.length;++q){var m=t.signature_requests[q].tx_input_index;if(x.isOutpointOneWeOffered(r.ins[m])){++n}}if(x.offered_outpoints.length!=n){throw"Could not find all our offered outpoints ("+x.offered_outpoints.length+" != "+n+")"}v(r)}catch(s){u(s)}},signNormal:function(m,q,s,p){console.log("Offer.signNormal()");var o=0;var r=[];var n=function(){setTimeout(function(){try{var t=q[o];if(t==null){throw"Null connected script"}var v=signInput(m,t.tx_input_index,t.priv_to_use,t,SIGHASH_ALL);if(v){o++;r.push({tx_input_index:t.tx_input_index,input_script:Crypto.util.bytesToHex(v.buffer),offer_outpoint_index:t.offer_outpoint_index});if(o==q.length){s(r)}else{n()}}else{throw"Unknown error signing transaction"}}catch(u){p(u)}},1)};n()},submitInputScripts:function(p,q,r,o,m){console.log("Offer.submitInputScripts()");var n=this;MyWallet.setLoadingText("Submitting Signatures");k=new Date().getTime();$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:f,data:{method:"submit_signatures",format:"json",input_scripts:JSON.stringify(q),offer_id:n.offer_id,proposal_id:p.proposal_id},success:function(s){if(s.status=="not_found"){o("Proposal Expired or Not Found")}else{if(s.status=="verification_failed"){o("Signature Verification Failed")}else{if(s.status=="complete"){m(s.tx_hash,s.tx)}else{if(s.status=="signatures_accepted"){r("Signatures Accepted")}else{o("Unknown status "+s.status)}}}}},error:function(s){o(s.responseText)}})},signInputs:function(u,r,x,v){console.log("Offer.signInputs()");var y=this;try{var s={};var n=[];for(var q=0;q<u.signature_requests.length;++q){var p=u.signature_requests[q];var w=new Bitcoin.Script(Crypto.util.hexToBytes(p.connected_script));if(w==null){throw"signInputs() Connected script is null"}w.tx_input_index=p.tx_input_index;w.offer_outpoint_index=p.offer_outpoint_index;var m=w.simpleOutPubKeyHash();var o=new Bitcoin.Address(m).toString();if(s[o]){w.priv_to_use=s[o]}else{if(e[o]){w.priv_to_use=Bitcoin.Base58.decode(e[o])}else{if(MyWallet.addressExists(o)&&!MyWallet.isWatchOnly(o)){w.priv_to_use=MyWallet.decodePK(MyWallet.getPrivateKey(o))}}}if(w.priv_to_use==null){throw"Private key not found"}else{s[o]=w.priv_to_use}n.push(w)}y.signNormal(r,n,function(z){x(z)},function(z){v(z)})}catch(t){v(t)}}}};this.generateAddressFromCustomSeed=function(o,r){var q=Crypto.SHA256(o+r,{asBytes:true});var p=new Bitcoin.ECKey(q);if(q[0]%2==0){var m=p.getBitcoinAddress()}else{var m=p.getBitcoinAddressCompressed()}e[m.toString()]=Bitcoin.Base58.encode(p.priv);return m};this.newPlan=function(){return{offers:[],n_stages:0,c_stage:0,address_seed:null,address_seen_n:0,generated_addresses:[],generateAddressFromSeed:function(){if(this.address_seed==null){var n=[];n.length=18;new SecureRandom().nextBytes(n);this.address_seed=Crypto.util.bytesToHex(n);MyWallet.addAdditionalSeeds(a+this.address_seed)}var m=c.generateAddressFromCustomSeed(a+this.address_seed,this.address_seen_n);this.address_seen_n++;return m},generateChangeAddress:function(){var n=MyWallet.generateNewKey();var m=n.getBitcoinAddress();this.generated_addresses.push(m.toString());return m},executeOffer:function(o,p,n){function m(r,q){console.log("executeOffer.complete");o.determineOutputsToOfferNextStage(q,function(t){for(var s in t){t[s].hash=r}p(t)},n)}o.submit(function(){console.log("Successfully Submitted Offer");o.pollForProposalID(function(q){console.log("Proposal ID "+q);o.getProposal(q,function(r){console.log("Got Proposal");o.checkProposal(r,function(s){console.log("Proposal Looks Good");o.signInputs(r,s,function(t){console.log("Inputs Signed");o.submitInputScripts(r,t,function(u){console.log("Submitted Input Scripts");r.pollForCompleted(m,n)},n,m)},n)},n)},n,m)},n)},n,m)},execute:function(p,n){var m=this;var o=function(q){m.c_stage=q;var s=m.offers[q];console.log("Executing Stage "+q);var r=function(t){q++;if(q<m.n_stages){m.offers[q].offered_outpoints=t;o(q)}else{if(q==m.n_stages){p()}}};m.executeOffer(s,r,function(t){console.log("executeOffer failed "+t);setTimeout(function(){m.executeOffer(s,r,n)},5000)})};MyWallet.backupWallet("update",function(){console.log("Saved Wallet");var t=MyWallet.getAdditionalSeeds();var s=false;for(var r in t){var q=t[r];if(q.indexOf(m.address_seed)>=0){s=true;break}}if(!s){n("Address Seed Not Found")}else{o(0)}},n)},constructRepetitions:function(s,y,z,N){try{var K=this;var A=BigInteger.ZERO;for(var O in s.offered_outpoints){A=A.add(BigInteger.valueOf(s.offered_outpoints[O].value))}var p=A;var F=BigInteger.ZERO;for(var G=0;G<K.n_stages-1;++G){var n=c.newOffer();if(G==0){for(var O in s.request_outputs){if(s.request_outputs[O].exclude_from_fee){var D=s.request_outputs.splice(O,1)[0];F=BigInteger.valueOf(D.value);p=p.subtract(F);break}}n.offered_outpoints=s.offered_outpoints.slice(0);s.offered_outpoints=[]}p=p.subtract(y[G]);var w=[10,5,1,0.5,0.3,0.1];var H=8;var S=Math.random();if(p.intValue()>=0.2*satoshi){var L=2;if(S>=0.5){L=3}}else{var L=1}var Q=BigInteger.ZERO;var r=100;if(F.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}else{if(F.compareTo(BigInteger.ZERO)>0){Q=F.divide(BigInteger.valueOf(100)).multiply(BigInteger.valueOf(r))}}console.log("changeValue "+Q.toString());if(Q.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0||F.subtract(Q).compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0){Q=F;F=BigInteger.ZERO}else{F=F.subtract(Q)}if(F.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}var q=p.add(F);var B=false;for(var o=0;o<1000;++o){for(var I in w){var v=(w[I]/100)*((Math.random()*30)-15);var t=BigInteger.valueOf(Math.round((w[I]+v)*satoshi));var E=q.divideAndRemainder(t);var m=E[0].intValue();if(m>c.getMaximumOfferNumberOfOutputs()){continue}if(m>=L&&m<=H){if(E[1].compareTo(BigInteger.ZERO)==0||E[1].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))>=0){var C=[];if(E[1].compareTo(BigInteger.ZERO)>0){if(m<=1){if(E[1].compareTo(c.getMinimumInputValue())<0||E[1].compareTo(c.getMaximumOutputValue())>0){continue}var u=K.generateAddressFromSeed();n.request_outputs.push({value:E[1].toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(u).buffer)})}else{C=g(E[1].intValue(),m)}}var R=true;for(var J=0;J<m;++J){var M=t;if(C[J]&&C[J]>0){M=M.add(BigInteger.valueOf(C[J]))}if(M.compareTo(c.getMinimumInputValue())<0||M.compareTo(c.getMaximumOutputValue())>0){R=false;break}}if(!R){continue}for(var J=0;J<m;++J){var u=K.generateAddressFromSeed();var M=t;if(C[J]&&C[J]>0){M=M.add(BigInteger.valueOf(C[J]))}n.request_outputs.push({value:M.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(u).buffer)})}B=true;break}}}if(B){break}}if(!B){var u=K.generateAddressFromSeed();n.request_outputs.push({value:q.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(u).buffer)})}if(Q.compareTo(BigInteger.ZERO)>0){var x=K.generateChangeAddress();if(Q.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 0 ("+Q.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}n.request_outputs.push({value:Q.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(x).buffer),exclude_from_fee:true})}K.offers.push(n)}if(F.compareTo(BigInteger.ZERO)>0){var x=K.generateChangeAddress();if(F.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 1 ("+F.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}s.request_outputs.push({value:F.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(x).buffer),exclude_from_fee:true})}K.offers.push(s);z(K)}catch(P){N(P)}}}};this.getMaximumOfferNumberOfInputs=function(){return l.maximum_offer_number_of_inputs};this.getMaximumOfferNumberOfOutputs=function(){return l.maximum_offer_number_of_outputs};this.getMinimumOutputValue=function(){return l.minimum_output_value};this.getMinimumOutputValueExcludingFee=function(){return l.minimum_output_value_exclude_fee};this.getToken=function(){return l.token};this.getMinimumInputValue=function(){return l.minimum_input_value};this.getMinimumSupportedVersion=function(){return l.min_supported_version};this.getIsEnabled=function(){return l.enabled};this.getMaximumOutputValue=function(){return l.maximum_output_value};this.getFee=function(){return l.fee_percent};this.getMinimumFee=function(){return l.minimum_fee?l.minimum_fee:0};this.constructPlan=function(o,v,C){try{var A=this;var D=o.find('select[name="repetitions"]');var x=parseInt(D.val());if(x<=0){throw"invalid number of repetitions"}var q=c.newPlan();function s(J){for(var I in q.generated_addresses){MyWallet.deleteAddress(q.generated_addresses[I])}C(J)}var F=initNewTx();var p=o.find('select[name="from"]');var r=p.val();if(r==null||r=="any"){F.from_addresses=MyWallet.getActiveAddresses()}else{if(p.attr("multiple")=="multiple"){F.from_addresses=r}else{F.from_addresses=[r]}}var w=o.find(".recipient");w.each(function(){try{var O=$(this);var N=O.find('input[name="send-value"]');var K=O.find('input[name="send-to-address"]');var L=0;try{L=precisionToSatoshiBN(N.val());if(L==null||L.compareTo(BigInteger.ZERO)<=0){throw"You must enter a value greater than zero"}}catch(M){throw"Invalid send amount"}var I=$.trim(K.val()).replace(/[\u200B-\u200D\uFEFF]/g,"");if(I==null||I.length==0){throw"You must enter a bitcoin address for each recipient"}var J=resolveAddress(I);if(J==null||J.length==0){throw"You must enter a bitcoin address for each recipient"}F.to_addresses.push({address:new Bitcoin.Address(J),value:L})}catch(M){s(M)}});if(F.to_addresses.length==0||F.to_addresses.length<w.length){return}var m=[];var u=[];for(var E in F.to_addresses){var H=F.to_addresses[E];m.push(H.value);for(var y=x-1;y>=0;--y){var B=c.calculateFeeForValue(H.value);H.value=H.value.add(B);var z=u[y];if(z){u[y]=z.add(B)}else{u[y]=B}}}var t=q.generateAddressFromSeed();F.min_input_confirmations=1;F.do_not_use_unspent_cache=true;F.allow_adjust=false;F.change_address=t;F.base_fee=BigInteger.ZERO;F.min_input_size=BigInteger.valueOf(c.getMinimumInputValue());F.min_free_output_size=BigInteger.valueOf(satoshi);F.fee=BigInteger.ZERO;F.ask_for_fee=function(J,I){I()};var n=c.newOffer();F.addListener({on_error:function(I){s()}});F.signInputs=function(){try{var S=this;if(S.tx.ins.length>c.getMaximumOfferNumberOfInputs()){s("Maximum number of inputs exceeded. Please consolidate some or lower the send amount");return}for(var L=0;L<S.tx.ins.length;++L){var Q=S.tx.ins[L];var J=Q.outpoint.hash;var P=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(J).reverse());n.offered_outpoints.push({hash:P,index:Q.outpoint.index,value:Q.outpoint.value.toString()})}for(var L=0;L<S.tx.outs.length;++L){var K=S.tx.outs[L];var O=K.value.slice(0);O.reverse();var R=new BigInteger(O);var I=new Bitcoin.Script(K.script).simpleOutPubKeyHash();var N=new Bitcoin.Address(I).toString();if(N.toString()==t.toString()){if(R.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 3 ("+R.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}n.request_outputs.push({value:R.toString(),script:Crypto.util.bytesToHex(K.script.buffer),exclude_from_fee:true})}else{if(m[L].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){throw"Output Value Too Small"}n.request_outputs.push({value:m[L].toString(),script:Crypto.util.bytesToHex(K.script.buffer)})}}q.n_stages=x;q.c_stage=0;q.constructRepetitions(n,u,v,function(T){s(T)})}catch(M){s(M)}};F.start()}catch(G){s(G)}};this.calculateFeeForValue=function(n){var o=BigInteger.valueOf(c.getMinimumFee());if(n.compareTo(BigInteger.ZERO)>0&&c.getFee()>0){var p=Math.ceil(100/c.getFee());var m=n.divide(BigInteger.valueOf(p));if(o.compareTo(m)>0){return o}else{return m}}else{return o}};this.recoverSeeds=function(m,r,n){var o=0;var q=[];function p(){var t=m[o];++o;for(var u=0;u<100;++u){var s=c.generateAddressFromCustomSeed(t,u).toString();q.push(s)}if(o==m.length){while(q.length>0){(function(v){BlockchainAPI.get_balances(v,function(A){try{var B=0;for(var z in A){var x=z;var C=A[x].final_balance;if(C>0){console.log("Balance "+x+" = "+C);var w=new Bitcoin.ECKey(Bitcoin.Base58.decode(e[x]));var y=w.getBitcoinAddress().toString();try{if(MyWallet.addPrivateKey(w,{compressed:x!=y,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){console.log("Imported "+x)}}catch(D){console.log("Error importing "+x)}}B+=C}MyWallet.makeNotice("success","misc-success",formatBTC(B)+" recovered from intermediate addresses");if(B>0){MyWallet.backupWalletDelayed("update",function(){MyWallet.get_history()})}r()}catch(D){n(D)}},n)})(q.splice(0,1000))}}else{setTimeout(p,100)}}setTimeout(p,100)};this.init=function(o){$("#sharedcoin-recover").unbind().click(function(){var s=$(this);MyWallet.getSecondPassword(function(){s.prop("disabled",true);var w=s.text();s.text("Working. Please Wait...");var x=MyWallet.getAdditionalSeeds();var t=[];for(var v in x){var u=x[v];if(u.indexOf(a)==0){t.push(u)}}c.recoverSeeds(t,function(){s.prop("disabled",false);s.text(w)},function(y){s.prop("disabled",false);s.text(w);MyWallet.makeNotice("error","misc-error",y)})})});var r=o.find(".send");var p=o.find(".send-options");var n=o.find('select[name="repetitions"]');r.unbind().prop("disabled",true);o.find('input[name="send-value"]').bind("keyup change",function(){m()});p.hide();function q(){var s=p.find("span");s.eq(0).text(formatBTC(c.getMaximumOutputValue()));s.eq(1).text(formatBTC(c.getMinimumOutputValue()));s.eq(2).text(c.getFee());s.eq(3).text(formatBTC(c.getMinimumFee()));p.show()}function m(){r.unbind();var t=parseInt(n.val());if(t>0&&c.getIsEnabled()&&h>=c.getMinimumSupportedVersion()){var s=precisionToSatoshiBN(o.find('input[name="send-value"]').val());if(s.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){r.prop("disabled",true)}else{if(s.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){r.prop("disabled",true)}else{r.prop("disabled",false);r.unbind().click(function(){MyWallet.disableLogout(true);var u=function(x,w){o.find("input,select,button").prop("disabled",false);m();MyWallet.disableLogout(false);MyWallet.makeNotice("error","misc-error",x);setTimeout(function(){if(w&&w.c_stage>=0){console.log("Recover Seed");c.recoverSeeds([a+w.address_seed],function(){console.log("Recover Success")},function(){console.log("Recover Error")})}},2000);d.enableCancel()};var v=function(){o.find("input,select,button").prop("disabled",false);MyWallet.makeNotice("success","misc-success","Sharedcoin Transaction Successfully Completed");MyWallet.disableLogout(false);d.hide();m()};if(s.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){MyWallet.makeNotice("error","misc-error","The Minimum Send Value is "+formatPrecision(c.getMinimumOutputValue()));return}else{if(s.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){MyWallet.makeNotice("error","misc-error","The Maximum Send Value is "+formatPrecision(c.getMaximumOutputValue()));return}}MyWallet.getSecondPassword(function(){loadScript("wallet/signer",function(){d.show();d.disableCancel();var z=precisionToSatoshiBN(o.find('input[name="send-value"]').val());var x=o.find('input[name="send-to-address"]').val();d.setAddressAndAmount(x,z);o.find("input,select,button").prop("disabled",true);MyWallet.setLoadingText("Constructing Plan. Please Wait.");var w=new Date().getTime()-k;var y=Math.max(0,j-w);if(y>0){$(".loading-indicator").fadeIn(200)}setTimeout(function(){$(".loading-indicator").hide();c.constructPlan(o,function(A){console.log("Created Plan");console.log(A);A.execute(v,function(B){u(B,A)})},u)},y)},u)},u)})}}}else{r.prop("disabled",true)}}MyWallet.setLoadingText("Fetching SharedCoin Info");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:b,retryLimit:f,data:{method:"get_info",format:"json"},success:function(u){try{l=u;if(!c.getIsEnabled()){throw"Shared Coin is currently disabled"}if(h<c.getMinimumSupportedVersion()){throw"Version out of date. Please update your client or reload the page."}q();n.empty();for(var s=u.recommended_min_iterations;s<=u.recommended_max_iterations;s+=1){n.append('<option value="'+(s)+'">'+(s)+" Repetitions</option>")}n.val(u.recommended_iterations)}catch(t){MyWallet.makeNotice("error","misc-error",t)}m()},error:function(s){r.prop("disabled",true);MyWallet.makeNotice("error","misc-error",s.responseText)}});m()}};
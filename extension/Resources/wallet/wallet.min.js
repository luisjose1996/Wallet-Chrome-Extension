var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ad;var M;var j;var aA;var ag;var w;var d;var aq=0;var P=0;var al=0;var K=0;var aK=0;var ay;var g={};var E=[];var F=false;var ao=0;var ak=0;var au=1000;var I={};var ar;var ai;var x=0.5;var ab=10;var b={};var aF=0;var q;var R;var U=[];var B;var N=60000;var A=false;var V;var s={pbkdf2_iterations:10,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false};this.setEncryptedWalletData=function(aM){if(!aM||aM.length==0){ad=null;ar=null;return}ad=aM;ar=ac();try{if(aF==0||s.always_keep_local_backup){localStorage.setItem("payload",ad)}}catch(aN){console.log(aN)}};this.setRealAuthType=function(aM){this.real_auth_type=aM};this.addEventListener=function(aM){U.push(aM)};this.getLogoutTime=function(){return s.logout_time};this.getDefaultPbkdf2Iterations=function(){return ab};this.getPbkdf2Iterations=function(){return s.pbkdf2_iterations};this.setLogoutTime=function(aM){s.logout_time=aM;clearInterval(R);R=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return ad};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aM){s.fee_policy=aM};this.setAlwaysKeepLocalBackup=function(aM){s.always_keep_local_backup=aM};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aM){s.html5_notifications=aM};this.getTransactions=function(){return E};this.addressExists=function(aM){return I[aM]!=null};this.getAddressTag=function(aM){return I[aM].tag};this.setAddressTag=function(aN,aM){I[aN].tag=aM};this.getAddressBook=function(){return g};this.getAddressLabel=function(aM){return I[aM].label};this.setAddressLabel=function(aM,aN){I[aM].label=aN};this.setAddressBalance=function(aM,aN){I[aM].balance=aN};this.getAddressBookLabel=function(aM){return g[aM]};this.isWatchOnly=function(aM){return I[aM].priv==null};this.getAddressBalance=function(aM){return I[aM].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aM){delete I[aM]};this.addAddressBookEntry=function(aN,aM){g[aN]=aM};this.getPrivateKey=function(aM){return I[aM].priv};this.setLabel=function(aM,aN){I[aM].label=aN;ae();c()};this.securePost=function(aN,aO,aP,aM){var aQ=jQuery.extend({},aO);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aQ.sharedKey=d;aQ.guid=M;aQ.format=aO.format?aO.format:"plain";$.ajax({dataType:aO.format?aO.format:"text",type:"POST",url:root+aN,data:aQ,success:function(aR){aP(aR)},error:function(aR){aM(aR)}})};this.isCorrectMainPassword=function(aM){return aA==aM};function Z(aN,aP){var aM=Crypto.SHA256(aN,{asBytes:true});for(var aO=1;aO<aP;++aO){aM=Crypto.SHA256(aM,{asBytes:true})}return Crypto.util.bytesToHex(aM)}this.setPbkdf2Iterations=function(aM,aO){var aN=function(aP){console.log("Panic "+aP)};h.getSecondPassword(function(){try{if(F){try{for(var aP in I){var aR=I[aP];if(aR.priv){aR.priv=h.encrypt(h.decryptPK(aR.priv),d+ag,aM);if(!aR.priv){throw"addr.priv is null"}}}s.pbkdf2_iterations=aM;w=Z(d+ag,s.pbkdf2_iterations);h.checkAllKeys();h.backupWallet("update",function(){aO()},function(){aN(aQ)})}catch(aQ){aN(aQ)}}else{h.backupWallet("update",function(){aO()},function(){aN(aQ)})}}catch(aQ){aN(aQ)}},function(aP){aN(aP)})};this.setDoubleEncryption=function(aO,aM,aQ){var aN=function(aR){console.log("Panic "+aR);window.location.reload()};try{if(F==aO){return}if(aO){h.getSecondPassword(function(){try{F=true;ag=aM;for(var aR in I){var aT=I[aR];if(aT.priv){aT.priv=i(B58.decode(aT.priv));if(!aT.priv){throw"addr.priv is null"}}}w=Z(d+ag,s.pbkdf2_iterations);ag=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aQ()},function(){aN(aU)})}catch(aU){aN(aU)}},function(aU){aN(aU)})}catch(aS){aN(aS)}},function(aR){aN(aR)})}else{h.getSecondPassword(function(){try{for(var aR in I){var aT=I[aR];if(aT.priv){aT.priv=h.decryptPK(aT.priv);if(!aT.priv){throw"addr.priv is null"}}}F=false;ag=null;h.checkAllKeys();h.backupWallet("update",function(){aQ()},function(){aN(aS)})}catch(aS){aN(aS)}},function(aR){aN(aR)})}}catch(aP){aN(aP)}};this.unArchiveAddr=function(aM){var aM=I[aM];if(aM.tag==2){aM.tag=null;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aM){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aM=I[aM];if(aM.tag==null||aM.tag==0){aM.tag=2;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aM){return aI(aM)};this.addPrivateKey=function(aN,aM){if(af()){return false}if(aN==null){throw"Unable to generate a new bitcoin address."}var aR=aM?aN.getBitcoinAddressCompressed().toString():aN.getBitcoinAddress().toString();var aQ=i(aN.priv);var aO=new Bitcoin.ECKey(h.decodePK(i(aN.priv)));if(aR!=aO.getBitcoinAddress().toString()&&aR!=aO.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aI(aR,aQ)){I[aR].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aR+'"}')}catch(aP){}}else{throw"Unable to add generated bitcoin address."}return aR};this.generateNewKey=function(){if(aA){var aM=Crypto.util.bytesToWords(Crypto.SHA256(aA,{asBytes:true}));for(var aO in aM){rng_seed_int(aM[aO])}}if(!V){V=$("body").data("extra_seed")}if(V){var aM=Crypto.util.bytesToWords(Crypto.util.hexToBytes(V));for(var aO in aM){rng_seed_int(aM[aO])}}var aN=new Bitcoin.ECKey(false);if(h.addPrivateKey(aN)){return aN}};this.setLoadingText=function(aM){$(".loading-text").text(aM)};function L(){try{$(".popover").remove()}catch(aM){}}$(window).resize(function(){$(".modal:visible").center();L()});function aH(aN,aM){aN.click(function(){z(aM.txIndex,aM.result)});aN.find(".show-note").mouseover(function(){var aO=aM.note?aM.note:b[aM.hash];aC(this,aO,aM.hash)});aN.find(".add-note").mouseover(function(){m(this,aM.hash)});return aN}function t(aN,aT){var aM=0;for(var aP=0;aP<aN.inputs.length;++aP){var aO=aN.inputs[aP].prev_out;if(!aO||!aO.addr){continue}var aS=I[aO.addr];if(aS){var aR=parseInt(aO.value);aM-=aR;if(aT){P+=aR;aS.balance-=aR}}}for(var aQ=0;aQ<aN.out.length;++aQ){var aO=aN.out[aQ];if(!aO||!aO.addr){continue}var aS=I[aO.addr];if(aS){var aR=parseInt(aO.value);aM+=aR;if(aT){al+=aR;aS.balance+=aR}}}return aM}function ac(){return Crypto.util.bytesToHex(Crypto.SHA256(ad,{asBytes:true}))}function y(aM){aM.onmessage=function(aU){try{var aR=$.parseJSON(aU.data);if(aR.op=="on_change"){var aV=ac();var aT=aR.checksum;console.log("On change old "+aV+" ==  new "+aT);if(aV!=aT){setTimeout(J,250)}}else{if(aR.op=="utx"){var aS=TransactionFromJSON(aR.x);for(var aX in E){if(E[aX].txIndex==aS.txIndex){return}}var aZ=t(aS,true);if(h.getHTML5Notifications()){var aQ=function(a0){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(a0.iconUrl,a0.title,a0.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(a0.title,a0).show()}}}}catch(a1){}};try{aQ({title:aZ>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aZ)+" BTC",iconUrl:resource+"cube48.png"})}catch(aU){console.log(aU)}}aS.result=aZ;aq+=aZ;K++;aS.setConfirmations(0);playSound("beep");if(ak==0&&ao==0){E.unshift(aS);var aW=false;if(E.length>50){E.pop();aW=true}}var aO=S();if("my-transactions"==aO){if(ak==0&&ao==0){$("#no-transactions").hide();if(s.tx_display==0){var aN=$("#transactions-compact").show();aH($(C(aS,I,g)),aS).prependTo(aN.find("tbody")).find("div").hide().slideDown("slow");if(aW){aN.find("tbody tr:last-child").remove()}}else{var aN=$("#transactions-detailed").show();aN.prepend(aS.getHTML(I,g));if(aW){aN.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aR.op=="block"){for(var aP=0;aP<aR.x.txIndexes.length;++aP){for(var aY=0;aY<E.length;++aY){if(E[aY].txIndex==aR.x.txIndexes[aP]){if(E[aY].blockHeight==null||E[aY].blockHeight==0){E[aY].blockHeight=aR.x.height;break}}}}ap(BlockFromJSON(aR.x));T()}}}}catch(aU){console.log(aU);console.log(aU.data)}};aM.onopen=function(){am("ok");var aQ='{"op":"blocks_sub"}';if(M!=null){aQ+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aO=h.getActiveAddresses();for(var aN in aO){aQ+='{"op":"addr_sub", "addr":"'+aO[aN]+'"}'}}catch(aP){alert(aP)}aM.send(aQ)};aM.onclose=function(){am("error")}}var aG="ok";function am(aN){var aM=$("#logout");if(aN=="loading_start"){aM.attr("src",resource+"logout-orange.png");return}else{if(aN!="loading_stop"){aG=aN}}if(aG=="ok"){aM.attr("src",resource+"logout.png")}else{if(aG=="error"){aM.attr("src",resource+"logout-red.png")}}}this.makeNotice=function(aN,aQ,aP,aO){if(aP==null||aP.length==0){return}console.log(aP);if(aO==null){aO=5000}var aM=$('<div class="alert alert-block alert-'+aN+'"></div>');aM.text(""+aP);if($("#"+aQ).length>0){aM.attr("id",aQ);return}$("#notices").append(aM).hide().fadeIn(200);if(aO>0){(function(){var aR=aM;setTimeout(function(){aR.fadeOut(250,function(){$(this).remove()})},aO)})()}};function ax(aM){return aM}function an(aM){return h.decryptPK(aM)}function X(aM){var aN=h.decodePK(aM);return Crypto.util.bytesToBase64(aN)}function k(aM){var aN=h.decodePK(aM);return Crypto.util.bytesToHex(aN)}this.base58ToSipa=function(aM,aR){var aN=h.decodePK(aM);var aO=new Bitcoin.ECKey(aN);while(aN.length<32){aN.unshift(0)}aN.unshift(128);if(aO.getBitcoinAddress().toString()==aR){}else{if(aO.getBitcoinAddressCompressed().toString()==aR){aN.push(1)}else{throw"Private Key does not match bitcoin address"+aR}}var aP=Crypto.SHA256(Crypto.SHA256(aN,{asBytes:true}),{asBytes:true});aN=aN.concat(aP.slice(0,4));var aQ=B58.encode(aN);return aQ};this.makeWalletJSON=function(aM){return h.makeCustomWalletJSON(aM,M,d)};this.makeCustomWalletJSON=function(aQ,aN,aS){var aP=ax;if(aQ=="base64"){aP=X}else{if(aQ=="hex"){aP=k}else{if(aQ=="sipa"){aP=h.base58ToSipa}else{if(aQ=="base58"){aP=an}}}}var aM='{\n	"guid" : "'+aN+'",\n	"sharedKey" : "'+aS+'",\n';if(F&&w!=null&&aP==ax){aM+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aM+='	"options" : '+JSON.stringify(s)+",\n"}aM+='	"keys" : [\n';for(var aO in I){var aR=I[aO];aM+='	{"addr" : "'+aR.addr+'"';if(aR.priv!=null){aM+=',\n	 "priv" : "'+aP(aR.priv,aR.addr)+'"'}if(aR.tag==2){aM+=',\n	 "tag" : '+aR.tag}if(aR.label!=null){aM+=',\n	 "label" : "'+aR.label+'"'}aM+="},\n";atLeastOne=true}if(atLeastOne){aM=aM.substring(0,aM.length-2)}aM+="\n	]";if(aw(g)>0){aM+=',\n	"address_book" : [\n';for(var aO in g){aM+='	{"addr" : "'+aO+'",\n';aM+='	 "label" : "'+g[aO]+'"},\n'}aM=aM.substring(0,aM.length-2);aM+="\n	]"}if(aw(b)>0){aM+=',\n	"tx_notes" : '+JSON.stringify(b)}aM+="\n}";return aM};this.get_history=function(aN,aM){BlockchainAPI.get_history(function(aO){H(aO,false);c();if(aN){aN()}},function(){if(aM){aM()}},ak,ao)};this.deleteAddressBook=function(aM){delete g[aM];ae();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aM){$("#send-coins").find(".tab-pane.active").trigger("show",aM);if(aM){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aM,aN,aR){var aQ=aM.val();aM.empty();for(var aP in I){var aS=I[aP];if(!aS||aS.tag==2){continue}var aO=aS.label;if(!aO){aO=aS.addr.substring(0,15)+"..."}if(aN||aS.balance>0){aM.prepend('<option value="'+aS.addr+'">'+aO+" - "+formatBTC(aS.balance)+" BTC</option>")}}aM.prepend('<option value="any" selected>Any Address</option>');if(!aR&&aQ){aM.val(aQ)}}function r(aO,aP){l(aO.find('select[name="from"]'),false,aP);l(aO.find('select[name="change"]'),true,aP);aO.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aP){aO.find("input").val("");aO.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aO.find(".amount-needed").text(0)}var aN=aO.find(".recipient-container");if(aP){var aR=aN.find(".recipient:first-child").clone();aN.empty().append(aR)}function aM(){var aS=0;aO.find('input[name="send-value"]').each(function(){var aT=parseFloat($(this).val());if(!isNaN(aT)){aS+=aT}});return aS}function aQ(aS){aS.find('input[name="send-to-address"]').val("").typeahead({source:at()}).next().click(function(){var aT=$(this).prev();h.scanQRCode(function(aU){console.log(aU);try{new Bitcoin.Address(aU);aT.val(aU)}catch(aV){loadScript("wallet/jsuri-1.1.1",function(){try{var aW=new Uri(aU);aT.val(aW.host());aS.find('input[name="send-value"]').val(aW.getQueryParamValue("amount"))}catch(aX){h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})}},function(aU){h.makeNotice("error","misc-error",aU)})});aS.find(".local-symbol").text(symbol_local.symbol);aS.find('input[name="send-value"]').val("").bind("keyup change",function(aT){if(aT.keyCode=="9"){return}aO.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aM().toFixed(8)).toString()));aS.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aS.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aT){if(aT.keyCode=="9"){return}aS.find('input[name="send-value"]').val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aN.find(".recipient").each(function(){aQ($(this))});aO.find(".remove-recipient").unbind().click(function(){var aS=aN.find(".recipient").length;if(aS>1){if(aS==2){$(this).hide(200)}aN.find(".recipient:last-child").remove()}});aO.find(".add-recipient").unbind().click(function(){var aS=aN.find(".recipient:first-child").clone();aS.appendTo(aN);aQ(aS);aO.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aN=[];for(var aM in I){aN.push(aM)}return aN};this.getPreferredAddress=function(){var aN=null;for(var aM in I){var aO=I[aM];if(aN==null){aN=aO}if(aO.priv!=null){if(aN==null){aN=aO}if(aO.tag==null||aO.tag==0){aN=aO;break}}}return aN.addr};function aJ(){console.log("backupInstructionsModal");var aM=$("#restore-backup-modal");aM.modal({keyboard:true,backdrop:"static",show:true});aM.find(".btn.btn-secondary").unbind().click(function(){aM.modal("hide")})}this.scanQRCode=function(aO,aM){var aN=$("#qr-code-reader-modal");aN.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aN,function(aP){aN.modal("hide");aO(aP)},function(aP){aN.modal("hide");aM(aP)})},aM);aN.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aN.modal("hide");aM()})};this.getActiveAddresses=function(){var aO=[];for(var aM in I){var aN=I[aM];if(aN.tag!=2){aO.push(aN.addr)}}return aO};this.getArchivedAddresses=function(){var aO=[];for(var aM in I){var aN=I[aM];if(aN.tag==2){aO.push(aN.addr)}}return aO};function ap(aP){if(aP!=null){ay=aP;for(var aN in E){var aM=E[aN];if(aM.blockHeight!=null&&aM.blockHeight>0){var aO=ay.height-aM.blockHeight+1;if(aO<=100){aM.setConfirmations(ay.height-aM.blockHeight+1)}else{aM.setConfirmations(null)}}else{aM.setConfirmations(0)}}}}function z(aN,aM){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aN+"?result="+aM+"&guid="+M})})}this.deleteNote=function(aM){delete b[aM];c();ae()};function m(aM,aN){(function(aP,aR){aP=$(aP);if(!aP.data("popover")){aP.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aP.data("popover").tip().is(":visible")){return}}aP.popover("show");aP.mouseleave(function(){if(!aP.__timeout){aP.__timeout=setTimeout(function(){aP.popover("hide")},250)}});function aO(){if(aP.__timeout){clearTimeout(aP.__timeout);aP.__timeout=null}}var aQ=aP.data("popover").tip().mouseenter(aO);aQ.find("textarea").focus(aO);aQ.mouseleave(function(){aP.__timeout=setTimeout(function(){aP.popover("hide")},250)});aQ.find("i").unbind().click(function(){aP.popover("hide")});aQ.find("button").click(function(){var aS=$.trim($("<div>"+aQ.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aS.length>0){b[aR]=aS;ae()}c()})})(aM,aN)}function aC(aM,aN,aO){(function(aP,aQ,aS){aP=$(aP);if(!aP.data("popover")){var aT="Note";if(b[aS]){aT+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aP).popover({title:aT,trigger:"manual",content:aQ})}else{if(aP.data("popover").tip().is(":visible")){return}}aP.popover("show");aP.mouseleave(function(){if(!aP.__timeout){aP.__timeout=setTimeout(function(){aP.popover("hide")},250)}});var aR=aP.data("popover").tip().mouseenter(function(){if(aP.__timeout){clearTimeout(aP.__timeout);aP.__timeout=null}});aR.find("img").unbind().click(function(){h.deleteNote(aS)});aR.mouseleave(function(){aP.__timeout=setTimeout(function(){aP.popover("hide")},250)})})(aM,aN,aO)}function C(aP,aU,aR){var aV=aP.result;var aQ='<tr class="pointer" id="tx-'+aP.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aN=true;if(aV>=0){for(var aO=0;aO<aP.inputs.length;++aO){var aM=aP.inputs[aO].prev_out;if(!aM||!aM.addr){aN=false;aQ+='<span class="label">Newly Generated Coins</span>'}else{var aS=aU[aM.addr];if(aS){continue}aN=false;aQ+=formatOutput(aM,aU,aR)}}}else{if(aV<0){for(var aO=0;aO<aP.out.length;++aO){var aM=aP.out[aO];var aS=aU[aM.addr];if(aS&&aM.type==0){continue}aN=false;aQ+=formatOutput(aM,aU,aR)}}}if(aN){aQ+='<span class="label">Moved Between Wallet</info>'}aQ+="</ul></div></td><td><div>";var aT=aP.note?aP.note:b[aP.hash];if(aT){aQ+='<img src="'+resource+'note.png" class="show-note"> '}else{aQ+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aP.time>0){aQ+=dateToString(new Date(aP.time*1000))}if(aP.confirmations==0){aQ+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aP.confirmations>0){aQ+=' <span class="label label-info pull-right hidden-phone">'+aP.confirmations+" Confirmations</span> "}}aQ+="</div></td>";if(aV>0){aQ+='<td style="color:green"><div>'+formatMoney(aV,true)+"</div></td>"}else{if(aV<0){aQ+='<td style="color:red"><div>'+formatMoney(aV,true)+"</div></td>"}else{aQ+="<td><div>"+formatMoney(aV,true)+"</div></td>"}}if(aP.balance==null){aQ+="<td></td></tr>"}else{aQ+='<td class="hidden-phone"><div>'+formatMoney(aP.balance)+"</div></td></tr>"}return aQ}function S(){L();if(aq==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(aq,symbol));$("#balance2").html(formatSymbol(aq,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aM){var aN=S();if("send-coins"==aN){u(aM)}else{if("home-intro"==aN){f(aM)}else{if("receive-coins"==aN){aL(aM)}else{if("my-transactions"==aN){T(aM)}}}}}function f(aM){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(al,true));$("#summary-sent").html(formatMoney(P,true));$("#summary-balance").html(formatMoney(aq,symbol));var aO=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aO+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aO)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aN=$("#my-primary-address");if(aN.text()!=aO){aN.text(aO);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:aO})})}}}function Q(){var aM=$("#export-warning").show();var aN=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aM.hide();loadScript("wallet/import-export",function(){ImportExport.init(aN,function(){aN.show()},function(){aa($("#home-intro"))})},function(aO){h.makeNotice("error","misc-error",aO);aa($("#home-intro"))})},function(){aa($("#home-intro"))})})}function T(){var aN=null;var aP=0;if(aN!=null){clearInterval(aN);aN=null}var aM;if(s.tx_display==0){$("#transactions-detailed").hide();aM=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aM=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aO=function(){for(var aT=aP;aT<E.length&&aT<(aP+10);++aT){var aS=E[aT];if(s.tx_display==0){aM.append(aH($(C(aS,I,g)),aS))}else{aM.append(aS.getHTML(I,g))}}aP+=10;if(aP<E.length){aN=setTimeout(aO,15)}else{setupSymbolToggle();L();var aR=$(".pagination ul").empty();if(ao==0&&E.length<50){aR.hide();return}else{aR.show()}var aQ=Math.ceil(aK/50);var aU=" disabled";if(ao>0){aU=""}aR.append($('<li class="prev'+aU+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(ao-1)}));for(var aT=0;aT<aQ&&aT<=10;++aT){(function(aV){var aW="";if(ao==aV){aW=' class="active"'}aR.append($("<li"+aW+'><a class="hidden-phone">'+aV+"</a></li>").click(function(){h.setPage(aV)}))})(aT)}var aU=" disabled";if(ao<aQ){aU=""}aR.append($('<li class="next'+aU+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(ao+1)}))}};aO()}this.setPage=function(aM){ao=aM;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aP,aO){if(!aO&&aP.mixer_fee){x=aP.mixer_fee}if(aP.disable_mixer){$("#shared-addresses,#send-shared").hide()}E.length=0;if(aP.wallet==null){al=0;P=0;aq=0;K=0;aK=0;return}al=aP.wallet.total_received;P=aP.wallet.total_sent;aq=aP.wallet.final_balance;K=aP.wallet.n_tx;aK=aP.wallet.n_tx_filtered;for(var aN=0;aN<aP.addresses.length;++aN){if(I[aP.addresses[aN].address]){I[aP.addresses[aN].address].balance=aP.addresses[aN].final_balance}}for(var aN=0;aN<aP.txs.length;++aN){var aM=TransactionFromJSON(aP.txs[aN]);aM.result=t(aM,false);E.push(aM)}if(aP.info){$("#nodes-connected").html(aP.info.nconnected);if(aP.info.latest_block!=null){ap(aP.info.latest_block)}setLocalSymbol(aP.info.symbol_local)}}function aD(){R=setTimeout(h.logout,h.getLogoutTime());for(var aN in U){U[aN]("did_decrypt")}window.location.hash="";try{var aM=localStorage.getItem("multiaddr");if(aM!=null){H($.parseJSON(aM),true);c()}}catch(aO){}h.get_history();aa($("#home-intro"));$("#initial_error,#initial_success").remove()}function J(){for(var aM in I){var aO=I[aM];if(aO.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+ar);var aN={guid:M,sharedKey:d,format:"plain"};if(ar&&ar.length>0){aN.checksum=ar}$.ajax({type:"GET",url:root+"wallet/wallet.aes.json",data:aN,success:function(aP){if(aP==null||aP.length==0||aP=="Not modified"){return}console.log("Wallet data modified");h.setEncryptedWalletData(aP);if(W()){h.get_history();c()}else{window.location.reload()}}})}function W(){try{if(ad==null||ad.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aP=null;h.decrypt(ad,aA,h.getDefaultPbkdf2Iterations(),function(aQ){try{aP=$.parseJSON(aQ);return(aP!=null)}catch(aR){return false}});if(aP==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aP.double_encryption&&aP.dpasswordhash){F=aP.double_encryption;w=aP.dpasswordhash}if(aP.options){$.extend(s,aP.options)}else{if(aP.fee_policy){h.setFeePolicy(aP.fee_policy)}if(aP.html5_notifications){h.setHTML5Notifications(aP.html5_notifications)}}I={};for(var aN=0;aN<aP.keys.length;++aN){var aM=aP.keys[aN];if(aM.addr==null||aM.addr.length==0||aM.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(aM.tag==1){aM.tag=null}I[aM.addr]=aM}g={};if(aP.address_book){for(var aN=0;aN<aP.address_book.length;++aN){h.addAddressBookEntry(aP.address_book[aN].addr,aP.address_book[aN].label)}}if(aP.tx_notes){b=aP.tx_notes}d=aP.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(ar==null||ar.length==0){ar=ac()}J();e();return true}catch(aO){h.makeNotice("error","misc-error",aO)}return false}this.getPassword=function(aR,aS,aP){if(!aR.is(":visible")){aR.trigger("hidden");aR.unbind()}aR.modal({keyboard:false,backdrop:"static",show:true});aR.center();var aQ=aR.find('input[name="password"]');var aU=aQ,aM=false,aT=false;aR.find(".vkeyboard li").unbind().click(function(){var aX=$(this),aW=aX.html();if(aX.hasClass("left-shift")||aX.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aM=(aM===true)?false:true;aT=false;return false}if(aX.hasClass("capslock")){$(".letter").toggleClass("uppercase");aT=true;return false}if(aX.hasClass("delete")){var aV=aU.val();aU.val(aV.substr(0,aV.length-1));return false}if(aX.hasClass("symbol")){aW=$("span:visible",aX).html()}if(aX.hasClass("space")){aW=" "}if(aX.hasClass("tab")){aW="\t"}if(aX.hasClass("return")){aW="\n"}if(aX.hasClass("uppercase")){aW=aW.toUpperCase()}if(aM===true){$(".symbol span").toggle();if(aT===false){$(".letter").toggleClass("uppercase")}aM=false}aU.val(aU.val()+aW)});aQ.keypress(function(aV){if(aV.keyCode==13){aV.preventDefault();aR.find(".btn.btn-primary").click()}});aQ.val("");var aN=aR.find(".btn.btn-primary");aN.click(function(){if(aS){aP=null;var aV=aS;aS=null;setTimeout(function(){aV(aQ.val())},10)}aR.modal("hide")});var aO=aR.find(".btn.btn-secondary");aO.click(function(){if(aP){var aV=aP;aP=null;aS=null;setTimeout(function(){try{aV()}catch(aW){h.makeNotice("error","misc-error",aW)}},10)}aR.modal("hide")});aR.on("hidden",function(){aQ.unbind();aO.unbind();aN.unbind();aR.unbind();if(aP){var aV=aP;aP=null;aS=null;setTimeout(function(){try{aV()}catch(aW){h.makeNotice("error","misc-error",aW)}},10)}})};this.makePairingQRCode=function(aN,aM){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aM==1){h.securePost("wallet",{method:"pairing-encryption-password"},function(aP){aN($("<div></div>").qrcode({width:300,height:300,text:"1|"+M+"|"+h.encrypt(d+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aA)),aP,ab)}))},function(aP){h.makeNotice("error","misc-error",aP)})}else{if(aM==0){aN($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+aA}))}}}catch(aO){h.makeNotice("error","misc-error",aO)}})},function(){h.logout()})};this.getMainPassword=function(aN,aM){if(B>new Date().getTime()-N){return aN(aA)}h.getPassword($("#main-password-modal"),function(aO){if(aA==aO){B=new Date().getTime();if(aN){try{aN(aA)}catch(aP){h.makeNotice("error","misc-error",aP)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aM){try{aM()}catch(aP){h.makeNotice("error","misc-error",aP)}}}},aM)};this.getSecondPassword=function(aO,aM){if(!F||ag!=null){if(aO){try{aO(ag)}catch(aN){h.makeNotice("error","misc-error",aN)}}return}h.getPassword($("#second-password-modal"),function(aP){try{if(aB(aP)){if(aO){try{aO(aP)}catch(aQ){console.log(aQ);h.makeNotice("error","misc-error",aQ)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aM){try{aM()}catch(aQ){h.makeNotice("error","misc-error",aQ)}}}}catch(aQ){if(aM){try{aM()}catch(aQ){h.makeNotice("error","misc-error",aQ)}}}},aM)};function a(){if(A){console.log("Already initd");return}var aM=$("#restore-password");aA=aM.val();aM.val("");B=new Date().getTime();if(ad==null||ad.length==0){h.setLoadingText("Validating Authentication key");var aN=$.trim($(".auth-"+q).find(".code").val());if(aN.length==0||aN.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aN,length:aN.length,method:"get-wallet",format:"plain"},success:function(aO){try{if(aO==null||aO.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}h.setEncryptedWalletData(aO);$(".auth-"+q).hide();$(".auth-0").show();if(W()){n();aD()}}catch(aP){h.makeNotice("error","misc-error",aP)}},error:function(aO){h.makeNotice("error","misc-error",aO.responseText)}})}else{if(W()){n();aD()}}return true}function e(){am("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aO,aN,aM){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var aQ=initNewTx();aQ.from_addresses=h.getActiveAddresses();aQ.to_addresses.push({address:new Bitcoin.Address(aO),value:Bitcoin.Util.parseValue(aN)});aQ.addListener(aM);aQ.start()}catch(aP){aM.on_error(aP)}},function(aP){aM.on_error(aP)})})};function G(){h.setLoadingText("Sending email backup");$.ajax({type:"POST",url:root+"wallet",data:{guid:M,sharedKey:d,method:"email-backup",format:"plain"},success:function(aM){h.makeNotice("success","backup-success",aM)},error:function(aM){h.makeNotice("error","misc-error",aM.responseText)}})}function ae(aP,aO,aN,aM){if(ai){clearInterval(ai);ai=null}ai=setTimeout(function(){h.backupWallet(aP,aO,aN,aM)},3000)}this.backupWallet=function(aT,aS,aM){if(ai){clearInterval(ai);ai=null}try{if(aT==null){aT="update"}if(aw(I)==0){return}var aO=h.makeWalletJSON();var aR=h.encrypt(aO,aA,ab);if(aR.length==0){throw"Error encrypting the JSON output"}var aQ=null;h.decrypt(aR,aA,h.getDefaultPbkdf2Iterations(),function(aU){try{aQ=$.parseJSON(aU);return(aQ!=null)}catch(aV){return false}});if(aQ==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aN=ar;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aR);$.ajax({type:"POST",url:root+"wallet",data:{guid:M,length:aR.length,payload:aR,sharedKey:d,checksum:ar,old_checksum:aN,method:aT},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aV){var aX=false;for(var aU in I){var aW=I[aU];if(aW.tag==1){aW.tag=null;aX=true}}h.makeNotice("success","misc-success",aV);c();if(aS!=null){aS()}},error:function(aV){for(var aU in I){var aW=I[aU];if(aW.tag==1){$("#not-synced-warning-modal").modal("show");break}}if(aV.responseText==null){h.makeNotice("error","misc-error","Error Saving Wallet",10000)}else{h.makeNotice("error","misc-error",aV.responseText,10000)}c();if(aM!=null){aM()}}})}catch(aP){h.makeNotice("error","misc-error","Error Saving Wallet: "+aP,10000);c();if(aM!=null){aM(aP)}else{throw aP}}};function aE(aM){if(F){if(ag==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aM,d+ag,s.pbkdf2_iterations)}else{return aM}return null}this.isBase58=function(aO,aN){for(var aM=0;aM<aO.length;++aM){if(aO[aM]<0||aO[aM]>58){return false}}return true};this.encrypt=function(aO,aN,aM){return Crypto.AES.encrypt(aO,aN,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aM})};this.decrypt=function(aQ,aP,aN,aS,aO){try{var aM=Crypto.AES.decrypt(aQ,aP,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aN});if(aM!=null&&aM.length>0){if(aS(aM)){return aM}}}catch(aR){console.log(aR)}if(aN!=10){try{var aM=Crypto.AES.decrypt(aQ,aP,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aM!=null&&aM.length>0){if(aS(aM)){return aM}}}catch(aR){console.log(aR)}}try{var aM=Crypto.AES.decrypt(aQ,aP);if(aM!=null&&aM.length>0){if(aS(aM)){return aM}}}catch(aR){console.log(aR)}try{var aM=Crypto.AES.decrypt(aQ,aP,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aM!=null&&aM.length>0){if(aS(aM)){return aM}}}catch(aR){console.log(aR)}try{var aM=Crypto.AES.decrypt(aQ,aP,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aM!=null&&aM.length>0){if(aS(aM)){return aM}}}catch(aR){console.log(aR)}if(aO!=null){aO()}return null};this.setGUID=function(aP,aN){console.log("Set GUID "+aP);if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();try{var aM=localStorage.getItem("guid")}catch(aQ){}var aO=$("#restore-wallet-continue");aO.attr("disabled",true);console.log("Set GUID ajax");$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aP,data:{format:"json",resend_code:aN},success:function(aS){console.log("Set GUID Error");aO.attr("disabled",false);$(".auth-"+q).hide();V=aS.extra_seed;M=aS.guid;q=aS.auth_type;aF=aS.real_auth_type;h.setEncryptedWalletData(aS.payload);war_checksum=aS.war_checksum;setLocalSymbol(aS.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();$("#forgot-password-btn").attr("disabled",false).click(function(){window.location=root+"wallet/forgot-password?guid="+M});$("#reset-two-factor-btn").attr("disabled",false).show().click(function(){window.location=root+"wallet/reset-two-factor?guid="+M});if(aS.initial_error){h.makeNotice("error","misc-error",aS.initial_error)}if(aS.initial_success){h.makeNotice("success","misc-success",aS.initial_success)}try{if(aM!=M){localStorage.clear();if(M!=D){localStorage.setItem("guid",M)}}}catch(aR){}},error:function(aS){console.log("Set GUID Success");aO.attr("disabled",false);if(aM==aP&&ad){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=aM;ar=ac();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var aR=$.parseJSON(aS.responseText);if(aR.initial_error){h.makeNotice("error","misc-error",aR.initial_error);return}}catch(aS){}if(aS.responseText){h.makeNotice("error","misc-error",aS.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}}})};function i(aM){var aN=B58.encode(aM);return aE(aN)}this.decryptPK=function(aM){if(F){if(ag==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aM,d+ag,s.pbkdf2_iterations,h.isBase58)}else{return aM}return null};this.decodePK=function(aN){var aM=h.decryptPK(aN);if(aM!=null){return B58.decode(aM)}return null};this.signmessage=function(aM,aO){var aQ=I[aM];var aP=h.decodePK(aQ.priv);var aN=new Bitcoin.ECKey(aP);return Bitcoin.Message.signMessage(aN,aO,aQ.addr)};function aB(aN){var aM=Crypto.SHA256(d+aN,{asBytes:true});var aQ=Z(aM,s.pbkdf2_iterations-1);if(aQ==w){ag=aN;return true}if(s.pbkdf2_iterations!=10){var aO=Z(aM,10-1);if(aO==w){ag=aN;w=aQ;return true}}if(Crypto.util.bytesToHex(aM)==w){ag=aN;w=aQ;return true}var aP=Crypto.SHA256(aN);if(aP==w){ag=aN;w=aQ;return true}return false}this.checkAllKeys=function(aM){for(var aN in I){var aR=I[aN];if(aR.addr==null){throw"Null Address Found in wallet "+aN}if(aR.addr.toString()==null){throw"Error decoding wallet address "+aR.addr}if(aR.priv!=null){var aQ=h.decodePK(aR.priv);var aP=new Bitcoin.ECKey(aQ);var aO=aP.getBitcoinAddress().toString();if(aO!=aR.addr&&aP.getBitcoinAddressCompressed().toString()!=aR.addr){throw"Private key does not match bitcoin address "+aR.addr+" != "+aO}if(aM){aR.priv=i(aQ)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aM){h.getMainPassword(function(){aA=aM;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function aa(aM){if(aM===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aM;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function aw(aO){var aN=0,aM;for(aM in aO){aN++}return aN}function Y(aM){I[aM].priv=null}function af(){if(aw(I)>=au){h.makeNotice("error","misc-error","We currently support a maximum of "+au+" private keys, please remove some unused ones.");return true}return false}function aI(aO,aM){var aN=I[aO];if(!aN||aN.length==0){I[aO]={addr:aO,priv:aM,balance:0};return true}else{if(!aN.priv&&aM){aN.priv=aM;return true}}return false}function o(){var aO=$("#add-address-book-entry-modal");aO.modal({keyboard:true,backdrop:"static",show:true});var aM=aO.find('input[name="label"]');var aN=aO.find('input[name="address"]');aM.val("");aN.val("");aO.find(".btn.btn-primary").unbind().click(function(){aO.modal("hide");var aQ=$.trim($("<div>"+aM.val()+"</div>").text());var aP=$.trim(aN.val());if(aQ.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aQ.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aP.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aS;try{aS=new Bitcoin.Address(aP);if(aS==null){throw"Null address"}}catch(aR){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aP]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aP,aQ);ae();$("#send-coins").find(".tab-pane").trigger("show",true)});aO.find(".btn.btn-secondary").unbind().click(function(){aO.modal("hide")})}this.logout=function(){if(R){clearTimeout(R)}if(M==D){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aM){window.location.reload()},error:function(){window.location.reload()}})}};function aj(aS){var aU=$("#delete-address-modal");aU.modal({keyboard:true,backdrop:"static",show:true});aU.find(".btn.btn-primary").hide();aU.find(".btn.btn-danger").hide();$("#change-mind").hide();aU.find("#to-delete-address").html(aS.join(" "));aU.find("#delete-balance").empty();var aO=aU.find("#delete-balance");var aM=[];for(var aR in aS){var aT=aS[aR];if(I[aT]&&I[aT].priv){aM.push(aS[aR])}}BlockchainAPI.get_balance(aM,function(aV){aU.find(".btn.btn-primary").show(200);aU.find(".btn.btn-danger").show(200);aO.html("Balance "+formatBTC(aV)+" BTC");if(aV>0){aO.css("color","red")}else{aO.css("color","black")}},function(){aU.find(".btn.btn-primary").show(200);aU.find(".btn.btn-danger").show(200);aO.text("Error Fetching Balance")});var aP=false;var aR=0;var aN=null;var aQ=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aQ-aR)};aU.find(".btn.btn-primary").unbind().click(function(){changeMind();aU.find(".btn.btn-primary").hide();aU.find(".btn.btn-danger").hide();aN=setInterval(function(){if(aP){return}++aR;changeMind();if(aR==aQ){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aV in aS){Y(aS[aV])}c();h.backupWallet();clearInterval(aN)}},1000)});aU.find(".btn.btn-danger").unbind().click(function(){changeMind();aU.find(".btn.btn-primary").hide();aU.find(".btn.btn-danger").hide();aN=setInterval(function(){if(aP){return}++aR;changeMind();if(aR==aQ){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aV in aS){h.deleteAddress(aS[aV])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aN)}}},1000)});aU.unbind().on("hidden",function(){if(aN){aP=true;clearInterval(aN);aN=null}});aU.find(".btn.btn-secondary").unbind().click(function(){aU.modal("hide")})}function at(){var aO=[];for(var aM in g){aO.push(g[aM])}for(var aM in I){var aN=I[aM];if(aN.tag!=2&&aN.label){aO.push(aN.label)}}return aO}function O(aM){h.getSecondPassword(function(){var aO=$("#sweep-address-modal");aO.modal("show");BlockchainAPI.get_balance(aM,function(aP){aO.find(".balance").text("Amount: "+formatBTC(aP)+" BTC")},function(){aO.find(".balance").text("Error Fetching Balance")});var aN=aO.find('select[name="change"]');l(aN,true);aO.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aM,function(aP){var aQ=initNewTx();aQ.fee=aQ.base_fee;aQ.to_addresses.push({address:new Bitcoin.Address($.trim(aN.val())),value:BigInteger.valueOf(aP).subtract(aQ.fee)});aQ.from_addresses=aM;aQ.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aO.modal("hide")});aO.find(".btn.btn-secondary").unbind().click(function(){aO.modal("hide")})})}function av(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aM){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){aa($("#home-intro"))});$("#my-transactions-btn").click(function(){aa($("#my-transactions"))});$("#send-coins-btn").click(function(){aa($("#send-coins"))});$("#import-export-btn").click(function(){aa($("#import-export"));Q()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aM){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){aa($("#my-account"));var aM=$("#account-settings-warning").show();var aN=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aM.hide();loadScript("wallet/account",function(){AccountSettings.init(aN,function(){aN.show()},function(){aa($("#home-intro"))})},function(aO){h.makeNotice("error","misc-error",aO);aa($("#home-intro"))})},function(){aa($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aM=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aM);$("#archived-sweep").attr("disabled",!aM);$("#archived-delete").attr("disabled",!aM)});$("#shared-addresses").on("show",function(){var aM=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aM)})});$("#active-addresses").on("show",function(){var aS=$(this).find("table:first");aS.find("tbody:gt(0)").remove();var aP=aS.find("tbody").empty();for(var aR in I){var aT=I[aR];if(aT.tag==2){continue}var aQ="";if(aT.tag==1){aQ=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aT.priv==null){aQ=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aM="";var aO=aT.addr;if(aT.label!=null){aO=aT.label;aM='<span class="hidden-phone"> - '+aT.addr+"</span>"}var aN=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aT.addr+'" target="new">'+aO+"</a>"+aM+" "+aQ+'<div></td><td><span style="color:green">'+formatMoney(aT.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aU){aN.find(".act-archive").click(function(){h.archiveAddr(aU)});aN.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aU)})});aN.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(aU)})});aN.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(aU)})});aN.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aU+"</b>",src:root+"payment_request?address="+aU})})})})(aT.addr);if(aT.balance>0&&aT.priv){aS.prepend(aN)}else{aS.append(aN)}}av()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aN=$(this).find("tbody");var aM=h.getArchivedAddresses();var aO=function(){aN.empty();for(var aS in aM){var aU=I[aM[aS]];if(aU.tag!=2){continue}var aR="";if(aU.priv==null){aR=' <font color="red">(Watch Only)</font>'}var aP="";var aQ=aU.addr;if(aU.label!=null){aQ=aU.label;aP='<span class="hidden-phone"> - '+aU.addr+"</span>"}var aT=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aU.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aU.addr+'" target="new">'+aQ+"</a>"+aP+" "+aR+'<div></td><td><span style="color:green">'+formatBTC(aU.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aV){aT.find(".act-unarchive").click(function(){h.unArchiveAddr(aV)})})(aU.addr);if(aU.balance>0&&aU.priv){aN.prepend(aT)}else{aN.append(aT)}}};aO();BlockchainAPI.get_balances(aM,function(aP){aO()},function(aP){h.makeNotice("error","misc-error",aP)})});$("#archived-sweep").click(function(){var aM=[];$(".archived_checkbox:checked").each(function(){var aN=I[$(this).val()];if(aN.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aM.push(aN.addr)});if(aM.length==0){return}O(aM)});$("#archived-delete").click(function(){var aM=[];$(".archived_checkbox:checked").each(function(){aM.push($(this).val())});if(aM.length==0){return}aj(aM)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aO=$(this);var aN=h.getPreferredAddress();var aM=aO.data("extra");if(aM==null){aM=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:aO.data("title"),description:"Deposit into address <b>"+aN+"</b>",top_right:'Have Questions? Read <a href="'+aO.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aN+"&ptype="+aO.data("type")+"&guid="+M+"&sharedKey="+d+aM})})});$(".withdraw-btn").click(function(){var aM=$(this);h.getSecondPassword(function(){var aN=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aM.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(aq)+" BTC</b>",src:root+"withdraw?method="+aM.data("type")+"&address="+aN+"&balance="+aq+"&guid="+M+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aN=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aN);h.backupWallet("update",function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aN)})})})}catch(aM){h.makeNotice("error","misc-error",aM)}});$(".tx_filter a").click(function(){ao=0;ak=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aM=$(this).data("value");if(aM=="export"){v();return}s.tx_display=aM;c();ae()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+M+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+M+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aO,aN){var aM=$(this);r(aM,aN);aM.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aM,"quick",initNewTx())})})});$("#send-email").on("show",function(aO,aN){var aM=$(this);r(aM,aN);aM.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aM,"email",initNewTx())})})});$("#send-shared").on("show",function(aO,aN){var aM=$(this);r(aM,aN);aM.find(".mixer_fee").text(x);aM.find(".fees,.free,.bonus").show();if(x<0){aM.find(".fees,.free").hide()}else{if(x==0){aM.find(".fees,.bonus").hide()}else{aM.find(".free,.bonus").hide()}}aM.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aM,"shared",initNewTx())})});aM.find(".shared-fees").text("0.00");aM.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aQ=parseFloat($.trim($(this).val()));var aP=0;if(aQ>0){if(x>0){aP=parseFloat(aQ+((aQ/100)*x))}else{aP=parseFloat(aQ);aM.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*x)}}if(aQ<0.2||aQ>250){aM.find(".shared-fees").text("0.00");aM.find(".send").attr("disabled",true)}else{aM.find(".shared-fees").text(aP.toFixed(4));aM.find(".send").attr("disabled",false)}aM.find('input[name="send-value"]').val(aP).trigger("keyup")})});$("#send-custom").on("show",function(aO,aN){var aM=$(this);r(aM,aN);aM.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aM,"custom",initNewTx())})});aM.find('select[name="from"]').unbind().change(function(){var aR=0;var aP=$(this).val();for(var aQ in aP){if(aP[aQ]=="any"){$(this).val("any");aR=aq;break}else{var aS=I[aP[aQ]];if(aS&&aS.balance){aR+=aS.balance}}}aM.find(".amount-available").text(formatBTC(aR))}).trigger("change");aM.find(".reset").unbind().click(function(){r(aM,true);aM.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aO,aN){var aM=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aM))}catch(aP){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aP){h.makeNotice("error","misc-error",aP)})});$("#send-sms").on("show",function(aO,aN){if(aN){return}var aM=$(this);r(aM);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aP){aM.find('select[name="sms-country-code"]').html(aP)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aM.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var aP=initNewTx();startTxUI(aM,"sms",aP)})})});$("#address-book").on("show",function(){var aN=$("#address-book-tbl tbody");if(aw(g)>0){aN.empty();for(var aM in g){var aO=$("<tr><td>"+g[aM]+'</td><td><div class="addr-book-entry">'+aM+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aP){aO.find(".act-delete").click(function(){h.deleteAddressBook(aP)})})(aM);aN.append(aO)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aM){$(aM.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){aa($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();av()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$(".download-backup-btn").toggle(ad!=null).click(function(){$(this).attr("download","wallet.aes.json");if(!ad){h.makeNotice("error","error","No Wallet Data to Download");return}var aN=("download" in document.createElement("a"));if(window.Blob&&window.URL&&aN){var aO=new Blob([ad]);var aP=window.URL.createObjectURL(aO);$(this).attr("href",aP)}else{var aM=window.open(null,null,"width=700,height=800,toolbar=0");aM.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+ad+"</div></body></html>")}aJ()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aM){if(aM.keyCode==13){aM.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aN){aN.preventDefault();var aM=$.trim($("#restore-guid").val());if(aM.length==0){return}if(M!=aM){h.setGUID(aM,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function ah(aN){var aO=Crypto.SHA256(aN+"?");switch(aO.slice(0,2)){case"00":var aP=Crypto.SHA256(aN,{asBytes:true});return aP;break;case"01":var aM=Crypto.util.hexToBytes(aO.slice(2,4))[0];var aQ=Math.round(Math.pow(2,(aM/4)));var aP=Crypto.PBKDF2(aN,"Satoshi Nakamoto",32,{iterations:aQ,asBytes:true});return aP;break;default:console.log("invalid key");break}}function az(){var aO,aM="";if(window.getSelection){aO=window.getSelection();if(aO.rangeCount){var aP=aO.getRangeAt(0).cloneContents();var aN=document.createElement("div");aN.appendChild(aP);aM=aN.innerText}}else{if(document.selection&&document.selection.type=="Text"){aM=document.selection.createRange().htmlText}}return aM}this.detectPrivateKeyFormat=function(aN){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aN)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aN)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aN)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aN)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aN)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aN)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aN)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aN)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aN)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aN)){var aM=Crypto.SHA256(aN+"?",{asBytes:true});if(aM[0]===0||aM[0]===1){return"mini"}}throw"Unknown Key Format "+aN};this.privateKeyStringToKey=function(aN,aP){var aM=null;if(aP=="base58"){aM=B58.decode(aN)}else{if(aP=="base64"){aM=Crypto.util.base64ToBytes(aN)}else{if(aP=="hex"){aM=Crypto.util.hexToBytes(aN)}else{if(aP=="mini"){aM=ah(aN)}else{if(aP=="sipa"){var aO=B58.decode(aN);aO.shift();aM=aO.slice(0,aO.length-4)}else{if(aP=="sipa"){var aO=B58.decode(aN);aO.shift();aM=aO.slice(0,aO.length-4)}else{if(aP=="compsipa"){var aO=B58.decode(aN);aO.shift();aO.pop();aM=aO.slice(0,aO.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aM.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aM)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aN=$(document.body);M=aN.data("guid");d=aN.data("sharedkey");if(h.skip_init){return}try{ad=localStorage.getItem("payload");if((!M||M.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){M=localStorage.getItem("guid")}}catch(aP){}if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}if(top.location!=self.location){top.location=self.location.href}aN.ajaxStart(function(){am("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){am("loading_stop");$(".loading-indicator").hide()}).click(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).mousemove(function(aT){if(aT){rng_seed_int(aT.clientX*aT.clientY)}});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aO=false;var aS=17,aR=86,aM=67,aQ=67;$(document).keydown(function(aU){try{if(aU.keyCode==aS||aU.keyCode==aQ){aO=true}if(aO&&aU.keyCode==aM){var aT=$.trim(az());var aV=I[aT];if(aV!=null){if(aV.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aV.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aU){console.log(aU)}}).keyup(function(aT){if(aT.keyCode==aS||aT.keyCode==aQ){aO=false}})});function aL(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};
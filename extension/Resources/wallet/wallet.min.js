var MyWallet=new function(){var h=this;this.skip_init=false;var C="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var aa;var L;var j;var aw;var ad;var v;var d;var am=0;var O=0;var ai=0;var J=0;var aE=0;var au;var g={};var D=[];var E=false;var ak=0;var ah=0;var ap=1000;var H=[];var an;var af;var w=1.5;var R=10;var b={};var Q;var V=[];var A;var M=60000;var q;var z=false;var s={fee_policy:0,html5_notifications:false,logout_time:300000};this.addEventListener=function(aG){V.push(aG)};this.getLogoutTime=function(){return s.logout_time};this.setLogoutTime=function(aG){s.logout_time=aG;clearInterval(Q);Q=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return E};this.getEncryptedWalletData=function(){return aa};this.getFeePolicy=function(){return s.fee_policy};this.getGuid=function(){return L};this.setFeePolicy=function(aG){s.fee_policy=aG};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aG){s.html5_notifications=aG};this.getTransactions=function(){return D};this.addressExists=function(aG){return H[aG]!=null};this.getAddressTag=function(aG){return H[aG].tag};this.setAddressTag=function(aH,aG){H[aH].tag=aG};this.getAddressBook=function(){return g};this.getAddressLabel=function(aG){return H[aG].label};this.setAddressLabel=function(aG,aH){H[aG].label=aH};this.setAddressBalance=function(aG,aH){H[aG].balance=aH};this.getAddressBookLabel=function(aG){return g[aG]};this.isWatchOnly=function(aG){return H[aG].priv==null};this.getAddressBalance=function(aG){return H[aG].balance};this.getMixerFee=function(){return w};this.deleteAddress=function(aG){delete H[aG]};this.addAddressBookEntry=function(aH,aG){g[aH]=aG};this.getPrivateKey=function(aG){return H[aG].priv};this.setLabel=function(aG,aH){H[aG].label=aH;ab();c()};this.securePost=function(aG,aH){var aI=jQuery.extend({},aH);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aI.sharedKey=d;aI.guid=L;aI.format="plain";return $.post(root+aG,aI)};this.isCorrectMainPassword=function(aG){return aw==aG};this.setDoubleEncryption=function(aI,aG,aK){var aH=function(aL){console.log("Panic "+aL);window.location.reload()};try{if(E==aI){return}if(aI){h.getSecondPassword(function(){try{E=true;ad=aG;for(var aN in H){var aP=H[aN];if(aP.priv!=null){aP.priv=i(B58.decode(aP.priv))}}var aL=Crypto.SHA256(d+ad,{asBytes:true});for(var aM=1;aM<R;++aM){aL=Crypto.SHA256(aL,{asBytes:true})}v=Crypto.util.bytesToHex(aL);ad=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aK()},function(){aH(aQ)})}catch(aQ){aH(aQ)}},function(){aH()})}catch(aO){aH(aO)}},function(){aH()})}else{h.getSecondPassword(function(){try{for(var aL in H){var aN=H[aL];if(aN.priv!=null){aN.priv=h.decryptPK(aN.priv)}}E=false;ad=null;h.checkAllKeys();h.backupWallet("update",function(){aK()},function(){aH(aM)})}catch(aM){aH(aM)}},function(aL){aH(aL)})}}catch(aJ){aH(aJ)}};function K(){try{$(".pop").popover("hide")}catch(aG){}}$(window).resize(function(){$(".modal:visible").center();K()});this.setLoadingText=function(aG){$(".loading-text").text(aG)};function aC(aH,aG){aH.click(function(){y(aG.txIndex,aG.result)});aH.find(".show-note").mouseover(function(){var aI=aG.note?aG.note:b[aG.hash];ay(this,aI,aG.hash)});aH.find(".add-note").mouseover(function(){m(this,aG.hash)});return aH}function t(aH,aN){var aG=0;for(var aJ=0;aJ<aH.inputs.length;++aJ){var aI=aH.inputs[aJ].prev_out;if(!aI||!aI.addr){continue}var aM=H[aI.addr];if(aM){var aL=parseInt(aI.value);aG-=aL;if(aN){O+=aL;aM.balance-=aL}}}for(var aK=0;aK<aH.out.length;++aK){var aI=aH.out[aK];if(!aI||!aI.addr){continue}var aM=H[aI.addr];if(aM){var aL=parseInt(aI.value);aG+=aL;if(aN){ai+=aL;aM.balance+=aL}}}return aG}function x(aG){aG.onmessage=function(aO){try{var aL=$.parseJSON(aO.data);if(aL.op=="status"){$("#status").html(aL.msg)}else{if(aL.op=="on_change"){var aP=Crypto.util.bytesToHex(Crypto.SHA256(aa,{asBytes:true}));var aN=aL.checksum;console.log("On change old "+aP+" ==  new "+aN);if(aP!=aN){h.updateCacheManifest();setTimeout(I,250)}}else{if(aL.op=="utx"){var aM=TransactionFromJSON(aL.x);for(var aR in D){if(D[aR].txIndex==aM.txIndex){return}}var aT=t(aM,true);if(h.getHTML5Notifications()){var aK=function(aU){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aU.iconUrl,aU.title,aU.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aU.title,aU).show()}}}}catch(aV){}};try{aK({title:aT>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aT)+" BTC",iconUrl:resource+"cube48.png"})}catch(aO){console.log(aO)}}aM.result=aT;am+=aT;J++;aM.setConfirmations(0);playSound("beep");if(ah==0&&ak==0){D.unshift(aM);var aQ=false;if(D.length>50){D.pop();aQ=true}}var aI=S();if("my-transactions"==aI){if(ah==0&&ak==0){$("#no-transactions").hide();if($("#tx_display").val()==0){var aH=$("#transactions-compact").show();aC($(B(aM,H,g)),aM).prependTo(aH.find("tbody")).find("div").hide().slideDown("slow");if(aQ){aH.find("tbody tr:last-child").remove()}}else{var aH=$("#transactions-detailed").show();aH.prepend(aM.getHTML(H,g));if(aQ){aH.find("div:last-child").remove()}}}}else{c()}}else{if(aL.op=="block"){for(var aJ=0;aJ<aL.x.txIndexes.length;++aJ){for(var aS=0;aS<D.length;++aS){if(D[aS].txIndex==aL.x.txIndexes[aJ]){if(D[aS].blockHeight==null||D[aS].blockHeight==0){D[aS].blockHeight=aL.x.height;break}}}}al(BlockFromJSON(aL.x));U()}}}}}catch(aO){console.log(aO);console.log(aO.data)}};aG.onopen=function(){$("#status").html("CONNECTED.");var aK='{"op":"blocks_sub"}';if(L!=null){aK+='{"op":"wallet_sub","guid":"'+L+'"}'}try{var aI=h.getActiveAddresses();for(var aH in aI){aK+='{"op":"addr_sub", "addr":"'+aI[aH]+'"}'}}catch(aJ){alert(aJ)}aG.send(aK)};aG.onclose=function(){$("#status").html("DISCONNECTED.")}}this.makeNotice=function(aH,aK,aJ,aI){if(aJ==null||aJ.length==0){return}console.log(aJ);if(aI==null){aI=5000}var aG=$('<div class="alert alert-block alert-'+aH+'"></div>');aG.text(""+aJ);if($("#"+aK).length>0){aG.attr("id",aK);return}$("#notices").append(aG).hide().fadeIn(200);if(aI>0){(function(){var aL=aG;setTimeout(function(){aL.fadeOut(250,function(){$(this).remove()})},aI)})()}};function at(aG){return aG}function aj(aG){return h.decryptPK(aG)}function X(aG){var aH=h.decodePK(aG);return Crypto.util.bytesToBase64(aH)}function k(aG){var aH=h.decodePK(aG);return Crypto.util.bytesToHex(aH)}this.base58ToSipa=function(aG,aL){var aH=h.decodePK(aG);var aI=new Bitcoin.ECKey(aH);while(aH.length<32){aH.unshift(0)}aH.unshift(128);if(aI.getBitcoinAddress().toString()==aL){}else{if(aI.getBitcoinAddressCompressed().toString()==aL){aH.push(1)}else{throw"Private Key does not match bitcoin address"+aL}}var aJ=Crypto.SHA256(Crypto.SHA256(aH,{asBytes:true}),{asBytes:true});aH=aH.concat(aJ.slice(0,4));var aK=B58.encode(aH);return aK};this.makeWalletJSON=function(aG){return aB(aG,L,d)};function aB(aK,aH,aM){var aJ=at;if(aK=="base64"){aJ=X}else{if(aK=="hex"){aJ=k}else{if(aK=="sipa"){aJ=h.base58ToSipa}else{if(aK=="base58"){aJ=aj}}}}var aG='{\n	"guid" : "'+aH+'",\n	"sharedKey" : "'+aM+'",\n';if(E&&v!=null&&aJ==at){aG+='	"double_encryption" : '+E+',\n	"dpasswordhash" : "'+v+'",\n'}if(s){aG+='	"options" : '+JSON.stringify(s)+",\n"}aG+='	"keys" : [\n';for(var aI in H){var aL=H[aI];aG+='	{"addr" : "'+aL.addr+'"';if(aL.priv!=null){aG+=',\n	 "priv" : "'+aJ(aL.priv,aL.addr)+'"'}if(aL.tag==2){aG+=',\n	 "tag" : '+aL.tag}if(aL.label!=null){aG+=',\n	 "label" : "'+aL.label+'"'}aG+="},\n";atLeastOne=true}if(atLeastOne){aG=aG.substring(0,aG.length-2)}aG+="\n	]";if(ar(g)>0){aG+=',\n	"address_book" : [\n';for(var aI in g){aG+='	{"addr" : "'+aI+'",\n';aG+='	 "label" : "'+g[aI]+'"},\n'}aG=aG.substring(0,aG.length-2);aG+="\n	]"}if(ar(b)>0){aG+=',\n	"tx_notes" : '+JSON.stringify(b)}aG+="\n}";return aG}this.get_history=function(aH,aG){BlockchainAPI.get_history(function(aI){G(aI,false);c();if(aH){aH()}},function(){if(aG){aG()}},ah,ak)};this.deleteAddressBook=function(aG){delete g[aG];ab();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aG){$("#send-coins").find(".tab-pane.active").trigger("show",aG);if(aG){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aG,aH,aL){var aK=aG.val();aG.empty();for(var aJ in H){var aM=H[aJ];if(!aM||aM.tag==2){continue}var aI=aM.label;if(!aI){aI=aM.addr.substring(0,15)+"..."}if(aH||aM.balance>0){aG.prepend('<option value="'+aM.addr+'">'+aI+" - "+formatBTC(aM.balance)+" BTC</option>")}}aG.prepend('<option value="any" selected>Any Address</option>');if(!aL&&aK){aG.val(aK)}}function r(aI,aJ){l(aI.find('select[name="from"]'),false,aJ);l(aI.find('select[name="change"]'),true,aJ);aI.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aJ){aI.find("input").val("");aI.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aI.find(".amount-needed").text(0)}var aH=aI.find(".recipient-container");if(aJ){var aL=aH.find(".recipient:first-child").clone();aH.empty().append(aL)}function aG(){var aM=0;aI.find('input[name="send-value"]').each(function(){var aN=parseFloat($(this).val());if(!isNaN(aN)){aM+=aN}});return aM}function aK(aM){aM.find('input[name="send-to-address"]').val("").typeahead({source:ao()});aM.find(".local-symbol").text(symbol_local.symbol);aM.find('input[name="send-value"]').val("").bind("keyup change",function(aN){if(aN.keyCode=="9"){return}aI.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aG().toFixed(8)).toString()));aM.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aM.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aN){if(aN.keyCode=="9"){return}aM.find(".send-value").val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aH.find(".recipient").each(function(){aK($(this))});aI.find(".remove-recipient").unbind().click(function(){var aM=aH.find(".recipient").length;if(aM>1){if(aM==2){$(this).hide(200)}aH.find(".recipient:last-child").remove()}});aI.find(".add-recipient").unbind().click(function(){var aM=aH.find(".recipient:first-child").clone();aM.appendTo(aH);aK(aM);aI.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aH=[];for(var aG in H){aH.push(aG)}return aH};this.getPreferredAddress=function(){var aH=null;for(var aG in H){var aI=H[aG];if(aH==null){aH=aI}if(aI.priv!=null){if(aH==null){aH=aI}if(aI.tag==null||aI.tag==0){aH=aI;break}}}return aH.addr};function T(aG){var aJ=[];for(var aH in H){var aI=H[aH];if(aI.tag==aG){aJ.push(aI.addr)}}return aJ}this.getActiveAddresses=function(){return T()};this.getArchivedAddresses=function(){return T(2)};function al(aJ){if(aJ!=null){au=aJ;for(var aH in D){var aG=D[aH];if(aG.blockHeight!=null&&aG.blockHeight>0){var aI=au.height-aG.blockHeight+1;if(aI<=100){aG.setConfirmations(au.height-aG.blockHeight+1)}else{aG.setConfirmations(null)}}else{aG.setConfirmations(0)}}}}function y(aH,aG){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aH+"?result="+aG+"&guid="+L})})}this.deleteNote=function(aG){delete b[aG];c();ab()};function m(aG,aH){(function(aJ,aL){aJ=$(aJ);if(!aJ.data("popover")){aJ.popover({title:"Add Note",trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aJ.data("popover").tip().is(":visible")){return}}aJ.popover("show");aJ.mouseleave(function(){if(!aJ.__timeout){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)}});function aI(){if(aJ.__timeout){clearTimeout(aJ.__timeout);aJ.__timeout=null}}var aK=aJ.data("popover").tip().mouseenter(aI);aK.find("textarea").focus(aI);aK.mouseleave(function(){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)});aK.find("button").click(function(){var aM=$.trim($("<div>"+aK.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aM.length>0){b[aL]=aM;ab()}c()})})(aG,aH)}function ay(aG,aH,aI){(function(aJ,aK,aM){aJ=$(aJ);if(!aJ.data("popover")){var aN="Note";if(b[aM]){aN+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aJ).popover({title:aN,trigger:"manual",content:aK})}else{if(aJ.data("popover").tip().is(":visible")){return}}aJ.popover("show");aJ.mouseleave(function(){if(!aJ.__timeout){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)}});var aL=aJ.data("popover").tip().mouseenter(function(){if(aJ.__timeout){clearTimeout(aJ.__timeout);aJ.__timeout=null}});aL.find("img").unbind().click(function(){h.deleteNote(aM)});aL.mouseleave(function(){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)})})(aG,aH,aI)}function B(aJ,aO,aL){var aP=aJ.result;var aK='<tr class="pointer" id="tx-'+aJ.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aH=true;if(aP>=0){for(var aI=0;aI<aJ.inputs.length;++aI){var aG=aJ.inputs[aI].prev_out;if(!aG||!aG.addr){aH=false;aK+='<span class="label">Newly Generated Coins</span>'}else{var aM=aO[aG.addr];if(aM){continue}aH=false;aK+=formatOutput(aG,aO,aL)}}}else{if(aP<0){for(var aI=0;aI<aJ.out.length;++aI){var aG=aJ.out[aI];var aM=aO[aG.addr];if(aM&&aG.type==0){continue}aH=false;aK+=formatOutput(aG,aO,aL)}}}if(aH){aK+='<span class="label">Moved Between Wallet</info>'}aK+="</ul></div></td><td><div>";var aN=aJ.note?aJ.note:b[aJ.hash];if(aN){aK+='<img src="'+resource+'note.png" class="pop show-note"> '}else{aK+='<img src="'+resource+'note_grey.png" class="pop add-note"> '}if(aJ.time>0){aK+=dateToString(new Date(aJ.time*1000))}if(aJ.confirmations==0){aK+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aJ.confirmations>0){aK+=' <span class="label label-info pull-right hidden-phone">'+aJ.confirmations+" Confirmations</span> "}}aK+="</div></td>";if(aP>0){aK+='<td style="color:green"><div>'+formatMoney(aP,true)+"</div></td>"}else{if(aP<0){aK+='<td style="color:red"><div>'+formatMoney(aP,true)+"</div></td>"}else{aK+="<td><div>"+formatMoney(aP,true)+"</div></td>"}}if(aJ.balance==null){aK+="<td></td></tr>"}else{aK+='<td class="hidden-phone"><div>'+formatMoney(aJ.balance)+"</div></td></tr>"}return aK}function S(){K();if(am==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(am,symbol));$("#balance2").html(formatSymbol(am,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aG){var aH=S();if("send-coins"==aH){u(aG)}else{if("home-intro"==aH){f(aG)}else{if("receive-coins"==aH){aF(aG)}else{if("my-transactions"==aH){U(aG)}}}}}function f(aG){$("#summary-n-tx").html(J);$("#summary-received").html(formatMoney(ai,true));$("#summary-sent").html(formatMoney(O,true));$("#summary-balance").html(formatMoney(am,symbol));var aI=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aI+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aI)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aH=$("#my-primary-address");if(aH.text()!=aI){aH.text(aI);$("#my-primary-addres-qr-code").html('<img style="padding-right:10px;padding-bottom:10px" src="'+root+"qr?data="+aI+'&size=125">')}}}function P(){var aG=$("#export-warning").show();var aH=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aG.hide();loadScript("wallet/import-export.min.js",function(){ImportExport.init(aH,function(){aH.show()},function(){Z($("#home-intro"))})},function(aI){h.makeNotice("error","misc-error",aI);Z($("#home-intro"))})},function(){Z($("#home-intro"))})})}function U(){var aJ=$("#tx_display").val();var aH=null;var aK=0;if(aH!=null){clearInterval(aH);aH=null}var aG;if(aJ==0){$("#transactions-detailed").hide();aG=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aG=$("#transactions-detailed").empty().show()}if(D.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aI=function(){for(var aO=aK;aO<D.length&&aO<(aK+10);++aO){var aN=D[aO];if(aJ==0){aG.append(aC($(B(aN,H,g)),aN))}else{aG.append(aN.getHTML(H,g))}}aK+=10;if(aK<D.length){aH=setTimeout(aI,15)}else{var aM=$(".pagination ul").empty();if(ak==0&&D.length<50){aM.hide();return}else{aM.show()}var aL=Math.ceil(aE/50);var aP=" disabled";if(ak>0){aP=""}aM.append($('<li class="prev'+aP+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(ak-1)}));for(var aO=0;aO<aL&&aO<=10;++aO){(function(aQ){var aR="";if(ak==aQ){aR=' class="active"'}aM.append($("<li"+aR+'><a class="hidden-phone">'+aQ+"</a></li>").click(function(){h.setPage(aQ)}))})(aO)}var aP=" disabled";if(ak<aL){aP=""}aM.append($('<li class="next'+aP+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(ak+1)}))}};aI()}this.setPage=function(aG){ak=aG;scroll(0,0);h.get_history()};function G(aI,aJ){var aL=$.parseJSON(aI);if(!aJ&&aL.mixer_fee){w=aL.mixer_fee}D.length=0;if(aL.wallet==null){ai=0;O=0;am=0;J=0;aE=0;return}ai=aL.wallet.total_received;O=aL.wallet.total_sent;am=aL.wallet.final_balance;J=aL.wallet.n_tx;aE=aL.wallet.n_tx_filtered;for(var aH=0;aH<aL.addresses.length;++aH){if(H[aL.addresses[aH].address]){H[aL.addresses[aH].address].balance=aL.addresses[aH].final_balance}}for(var aH=0;aH<aL.txs.length;++aH){var aG=TransactionFromJSON(aL.txs[aH]);aG.result=t(aG,false);D.push(aG)}if(aL.info){$("#nodes-connected").html(aL.info.nconnected);if(aL.info.latest_block!=null){al(aL.info.latest_block)}var aK=aL.info.symbol_local;if(symbol==symbol_local){symbol_local=aK;symbol=aK;calcMoney()}else{if(!aJ){symbol_local=aK}}}}function az(){Q=setTimeout(h.logout,h.getLogoutTime());for(var aI in V){V[aI]("did_decrypt")}window.location.hash="";try{var aG=localStorage.getItem("guid");if(aG!=L){localStorage.clear();if(L!=C){localStorage.setItem("guid",L)}}else{var aH=localStorage.getItem("multiaddr");if(aH!=null){G(aH,true);c()}}}catch(aJ){}h.get_history();Z($("#home-intro"));$("#initial_error,#initial_success").remove()}function I(){for(var aG in H){var aH=H[aG];if(aH.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+an);$.get(root+"wallet/wallet.aes.json?guid="+L+"&sharedKey="+d+"&checksum="+an+"&format=plain").success(function(aI){if(aI==null||aI.length==0){return}if(aI=="Not modified"){console.log("Not modified");return}else{console.log("Wallet data modified");aa=aI;an=Crypto.util.bytesToHex(Crypto.SHA256(aa,{asBytes:true}));W();h.get_history();c()}})}function W(){try{if(aa==null||aa.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aJ=null;h.decrypt(aa,aw,function(aK){try{aJ=$.parseJSON(aK);return(aJ!=null)}catch(aL){return false}});if(aJ==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aJ.double_encryption&&aJ.dpasswordhash){E=aJ.double_encryption;v=aJ.dpasswordhash}if(aJ.options){$.extend(s,aJ.options)}else{if(aJ.fee_policy){h.setFeePolicy(aJ.fee_policy)}if(aJ.html5_notifications){h.setHTML5Notifications(aJ.html5_notifications)}}H.length=0;for(var aH=0;aH<aJ.keys.length;++aH){var aG=aJ.keys[aH];if(aG.addr==null||aG.addr.length==0||aG.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}H[aG.addr]=aG}g={};if(aJ.address_book!=null){for(var aH=0;aH<aJ.address_book.length;++aH){h.addAddressBookEntry(aJ.address_book[aH].addr,aJ.address_book[aH].label)}}if(aJ.tx_notes){b=aJ.tx_notes}d=aJ.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(an==null||an.length==0){an=Crypto.util.bytesToHex(Crypto.SHA256(aa,{asBytes:true}))}else{I()}e();return true}catch(aI){h.makeNotice("error","misc-error",aI)}return false}this.getPassword=function(aL,aM,aJ){aL.modal({keyboard:false,backdrop:"static",show:true});aL.center();var aI=aL.find('input[name="password"]');var aH=aI,aG=false,aK=false;aL.find(".vkeyboard li").click(function(){var aP=$(this),aO=aP.html();if(aP.hasClass("left-shift")||aP.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aG=(aG===true)?false:true;aK=false;return false}if(aP.hasClass("capslock")){$(".letter").toggleClass("uppercase");aK=true;return false}if(aP.hasClass("delete")){var aN=aH.val();aH.val(aN.substr(0,aN.length-1));return false}if(aP.hasClass("symbol")){aO=$("span:visible",aP).html()}if(aP.hasClass("space")){aO=" "}if(aP.hasClass("tab")){aO="\t"}if(aP.hasClass("return")){aO="\n"}if(aP.hasClass("uppercase")){aO=aO.toUpperCase()}if(aG===true){$(".symbol span").toggle();if(aK===false){$(".letter").toggleClass("uppercase")}aG=false}aH.val(aH.val()+aO)});aI.unbind().keypress(function(aN){if(aN.keyCode==13){aN.preventDefault();aL.find(".btn.btn-primary").click()}});aI.val("");aL.find(".btn.btn-primary").unbind().click(function(){if(aM){aJ=null;var aN=aM;aM=null;aL.modal("hide");setTimeout(function(){aN(aI.val())},100)}});aL.find(".btn.btn-secondary").unbind().click(function(){if(aJ){var aN=aJ;aJ=null;setTimeout(function(){try{aN()}catch(aO){h.makeNotice("error","misc-error",aO)}},100)}aL.modal("hide")});aL.unbind().on("hidden",function(){if(aJ){var aN=aJ;aJ=null;setTimeout(function(){try{aN()}catch(aO){h.makeNotice("error","misc-error",aO)}},100)}})};this.makePairingQRCode=function(aG){h.getMainPassword(function(){loadScript("wallet/qr.code.creator.js",function(){try{var aH=makeQRCode(300,300,1,L+"|"+d+"|"+aw);aG(aH)}catch(aI){h.makeNotice("error","misc-error",aI)}})},function(){h.logout()})};this.getMainPassword=function(aH,aG){if(A>new Date().getTime()-M){return aH(aw)}h.getPassword($("#main-password-modal"),function(aI){if(aw==aI){A=new Date().getTime();if(aH){try{aH(aw)}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aG){try{aG()}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}},aG)};this.getSecondPassword=function(aI,aG){if(!E||ad!=null){if(aI){try{aI(ad)}catch(aH){h.makeNotice("error","misc-error",aH)}}return}h.getPassword($("#second-password-modal"),function(aJ){if(ax(aJ)){if(aI){try{aI(aJ)}catch(aK){h.makeNotice("error","misc-error",aK)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aG){try{aG()}catch(aK){h.makeNotice("error","misc-error",aK)}}}},aG)};function a(){if(z){console.log("isIntialized true return");return}var aG=$("#restore-password");aw=aG.val();aG.val("");A=new Date().getTime();if(aa==null||aa.length==0){h.setLoadingText("Validating Authentication key");var aH=$.trim($(".auth-"+q).find(".code").val());if(aH.length==0||aH.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.post(root+"wallet",{guid:L,payload:aH,length:aH.length,method:"get-wallet",format:"plain"},function(aI){try{if(aI==null||aI.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}aa=aI;$(".auth-"+q).hide();$(".auth-0").show();if(W()){n();az()}}catch(aJ){h.makeNotice("error","misc-error",aJ)}}).error(function(aI){h.makeNotice("error","misc-error",aI.responseText)})}else{if(W()){n();az()}}return true}function e(){webSocketConnect(x);z=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show();$("#status-container").show()}this.quickSendNoUI=function(aI,aH,aG){loadScript("wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aK=initNewTx();aK.from_addresses=h.getActiveAddresses();aK.to_addresses.push({address:new Bitcoin.Address(aI),value:Bitcoin.Util.parseValue(aH)});aK.addListener(aG);aK.start()}catch(aJ){aG.on_error(aJ)}},function(aJ){aG.on_error(aJ)})})};function F(){h.setLoadingText("Sending email backup");$.post(root+"wallet",{guid:L,sharedKey:d,method:"email-backup",format:"plain"},function(aG){h.makeNotice("success","backup-success",aG)}).error(function(aG){h.makeNotice("error","misc-error",aG.responseText)})}this.updateCacheManifest=function(aG){try{var aH=window.applicationCache;console.log("Clear Cache Manifest");aH.addEventListener("updateready",function(aJ){aH.swapCache();if(aG){aG()}},false);aH.addEventListener("noupdate",function(aJ){if(aG){aG()}},false);aH.addEventListener("error",function(aJ){if(aG){aG()}},false);aH.update()}catch(aI){console.log(aI);if(aG){aG()}}};function ab(aJ,aI,aH,aG){if(af!=null){clearInterval(af);af=null}af=setTimeout(function(){h.backupWallet(aJ,aI,aH,aG)},3000)}this.insertWallet=function(aN,aP,aQ,aG,aI,aO){try{var aJ=aB(null,aN,aP);var aM=h.encrypt(aJ,aQ);if(aM.length==0){throw"Error encrypting the JSON output"}var aH=null;h.decrypt(aM,aQ,function(aR){try{aH=$.parseJSON(aR);return(aH!=null)}catch(aS){return false}});if(aH==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aK=Crypto.util.bytesToHex(Crypto.SHA256(aM,{asBytes:true}));h.setLoadingText("Saving wallet");if(aG==null){aG=""}aa=aM;$.ajax({type:"POST",url:root+"wallet"+aG,data:{guid:aN,length:aM.length,payload:aM,sharedKey:aP,checksum:aK,method:"insert"},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aS){var aU=false;for(var aR in H){var aT=H[aR];if(aT.tag==1){aT.tag=null;aU=true}}an=aK;h.makeNotice("success","misc-success",aS);c();if(aI!=null){aI()}h.updateCacheManifest()},error:function(aR){h.makeNotice("error","misc-error",aR.responseText,10000);c();if(aO!=null){aO()}}})}catch(aL){h.makeNotice("error","misc-error","Error Saving Wallet: "+aL,10000);c();if(aO!=null){aO(aL)}else{throw aL}}};this.backupWallet=function(aN,aM,aG){try{if(aN==null){aN="update"}if(ar(H)==0){return}var aI=h.makeWalletJSON();var aL=h.encrypt(aI,aw);if(aL.length==0){throw"Error encrypting the JSON output"}var aK=null;h.decrypt(aL,aw,function(aO){try{aK=$.parseJSON(aO);return(aK!=null)}catch(aP){return false}});if(aK==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aH=Crypto.util.bytesToHex(Crypto.SHA256(aL,{asBytes:true}));h.setLoadingText("Saving wallet");aa=aL;$.ajax({type:"POST",url:root+"wallet",data:{guid:L,length:aL.length,payload:aL,sharedKey:d,checksum:aH,old_checksum:an,method:aN},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aP){var aR=false;for(var aO in H){var aQ=H[aO];if(aQ.tag==1){aQ.tag=null;aR=true}}an=aH;h.makeNotice("success","misc-success",aP);c();if(aM!=null){aM()}h.updateCacheManifest()},error:function(aO){h.makeNotice("error","misc-error",aO.responseText,10000);c();if(errorcallback!=null){errorcallback()}}})}catch(aJ){h.makeNotice("error","misc-error","Error Saving Wallet: "+aJ,10000);c();if(errorcallback!=null){errorcallback(aJ)}else{throw aJ}}};function aA(aG){if(E){if(ad==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aG,d+ad)}else{return aG}return null}this.isBase58=function(aI,aH){for(var aG=0;aG<aI.length;++aG){if(aI[aG]<0||aI[aG]>58){return false}}return true};this.encrypt=function(aH,aG){return Crypto.AES.encrypt(aH,aG,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:R})};this.decrypt=function(aJ,aI,aL,aH){try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:R});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}if(aH!=null){aH()}return null};this.setGUID=function(aH,aG){if(z){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();$.get(root+"wallet/"+aH,{format:"json",resend_code:aG}).success(function(aJ){$(".auth-"+q).hide();L=aJ.guid;q=aJ.auth_type;an=aJ.payload_checksum;aa=aJ.payload;war_checksum=aJ.war_checksum;symbol_local=aJ.symbol_local;$("#restore-guid").val(L);$(".auth-"+q).show();if(aJ.initial_error){h.makeNotice("error","misc-error",aJ.initial_error)}if(aJ.initial_success){h.makeNotice("success","misc-success",aJ.initial_success)}try{localStorage.clear();if(L!=C){localStorage.setItem("guid",L)}}catch(aI){}}).error(function(aJ){console.log(aJ);try{var aI=$.parseJSON(aJ.responseText);if(aI.initial_error){h.makeNotice("error","misc-error",aI.initial_error);return}}catch(aJ){}h.makeNotice("error","misc-error","Error changing wallet identifier")})};function i(aG){var aH=B58.encode(aG);return aA(aH)}this.decryptPK=function(aG){if(E){if(ad==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aG,d+ad,h.isBase58)}else{return aG}return null};this.decodePK=function(aH){var aG=h.decryptPK(aH);if(aG!=null){return B58.decode(aG)}return null};this.signmessage=function(aG,aI){var aK=H[aG];var aJ=h.decodePK(aK.priv);var aH=new Bitcoin.ECKey(aJ);return Bitcoin.Message.signMessage(aH,aI,aK.addr)};function ax(aH){var aG=Crypto.SHA256(d+aH,{asBytes:true});var aJ=aG;for(var aI=1;aI<R;++aI){aJ=Crypto.SHA256(aJ,{asBytes:true})}var aL=Crypto.util.bytesToHex(aJ);if(aL==v){ad=aH;return true}if(Crypto.util.bytesToHex(aG)==v){ad=aH;v=aL;return true}var aK=Crypto.SHA256(aH);if(aK==v){ad=aH;v=aL;return true}return false}this.checkAllKeys=function(aG){for(var aH in H){var aL=H[aH];if(aL.addr==null){throw"Null Address Found in wallet "+aH}if(aL.addr.toString()==null){throw"Error decoding wallet address "+aL.addr}if(aL.priv!=null){var aK=h.decodePK(aL.priv);var aJ=new Bitcoin.ECKey(aK);var aI=aJ.getBitcoinAddress().toString();if(aI!=aL.addr&&aJ.getBitcoinAddressCompressed().toString()!=aL.addr){throw"Private key does not match bitcoin address "+aL.addr+" != "+aI}if(aG){aL.priv=i(aK)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aG){h.getMainPassword(function(){aw=aG;h.backupWallet("update",function(){h.updateCacheManifest(function(){h.logout()})},function(){h.logout()})})};function Z(aG){if(aG===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aG;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function ar(aI){var aH=0,aG;for(aG in aI){aH++}return aH}function Y(aG){H[aG].priv=null}function ac(){if(ar(H)>=ap){h.makeNotice("error","misc-error","We currently support a maximum of "+ap+" private keys, please remove some unused ones.");return true}return false}function aD(aI,aG){var aH=H[aI];if(!aH||aH.length==0){H[aI]={addr:aI,priv:aG,balance:0};return true}else{if(!aH.priv&&aG){aH.priv=aG;return true}}return false}function o(){var aI=$("#add-address-book-entry-modal");aI.modal({keyboard:true,backdrop:"static",show:true});var aG=aI.find('input[name="label"]');var aH=aI.find('input[name="address"]');aG.val("");aH.val("");aI.find(".btn.btn-primary").unbind().click(function(){aI.modal("hide");var aK=$.trim($("<div>"+aG.val()+"</div>").text());var aJ=$.trim(aH.val());if(aK.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aK.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aJ.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aM;try{aM=new Bitcoin.Address(aJ);if(aM==null){throw"Null address"}}catch(aL){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aJ]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aJ,aK);ab();$("#send-coins").find(".tab-pane").trigger("show",true)});aI.find(".btn.btn-secondary").unbind().click(function(){aI.modal("hide")})}this.logout=function(){$.get(root+"wallet/logout?format=plain").success(function(){window.location.reload()}).error(function(){window.location.reload()})};function ag(aM){var aO=$("#delete-address-modal");aO.modal({keyboard:true,backdrop:"static",show:true});aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();$("#change-mind").hide();aO.find("#to-delete-address").html(aM.join(" "));aO.find("#delete-balance").empty();var aI=aO.find("#delete-balance");var aG=[];for(var aL in aM){var aN=aM[aL];if(H[aN]&&H[aN].priv){aG.push(aM[aL])}}BlockchainAPI.get_balance(aG,function(aP){aO.find(".btn.btn-primary").show(200);aO.find(".btn.btn-danger").show(200);aI.html("Balance "+formatBTC(aP)+" BTC");if(aP>0){aI.css("color","red")}else{aI.css("color","black")}},function(){aO.find(".btn.btn-primary").show(200);aO.find(".btn.btn-danger").show(200);aI.text("Error Fetching Balance")});var aJ=false;var aL=0;var aH=null;var aK=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aK-aL)};aO.find(".btn.btn-primary").unbind().click(function(){changeMind();aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();aH=setInterval(function(){if(aJ){return}++aL;changeMind();if(aL==aK){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aP in aM){Y(aM[aP])}c();h.backupWallet();clearInterval(aH)}},1000)});aO.find(".btn.btn-danger").unbind().click(function(){changeMind();aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();aH=setInterval(function(){if(aJ){return}++aL;changeMind();if(aL==aK){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aP in aM){h.deleteAddress(aM[aP])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aH)}}},1000)});aO.unbind().on("hidden",function(){if(aH){aJ=true;clearInterval(aH);aH=null}});aO.find(".btn.btn-secondary").unbind().click(function(){aO.modal("hide")})}function ao(){var aI=[];for(var aG in g){aI.push(g[aG])}for(var aG in H){var aH=H[aG];if(aH.tag!=2&&aH.label){aI.push(aH.label)}}return aI}function N(aG){h.getSecondPassword(function(){var aI=$("#sweep-address-modal");aI.modal("show");BlockchainAPI.get_balance(aG,function(aJ){aI.find(".balance").text("Amount: "+formatBTC(aJ)+" BTC")},function(){aI.find(".balance").text("Error Fetching Balance")});var aH=aI.find('select[name="change"]');l(aH,true);aI.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer.min.js",function(){BlockchainAPI.get_balance(aG,function(aJ){var aK=initNewTx();aK.fee=aK.base_fee;aK.to_addresses.push({address:new Bitcoin.Address($.trim(aH.val())),value:BigInteger.valueOf(aJ).subtract(aK.fee)});aK.from_addresses=aG;aK.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aI.modal("hide")});aI.find(".btn.btn-secondary").unbind().click(function(){aI.modal("hide")})})}function aq(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aG){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){Z($("#home-intro"))});$("#my-transactions-btn").click(function(){Z($("#my-transactions"))});$("#send-coins-btn").click(function(){Z($("#send-coins"))});$("#import-export-btn").click(function(){Z($("#import-export"));P()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aI){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){Z($("#my-account"));var aI=$("#account-settings-warning").show();var aJ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aI.hide();loadScript("wallet/account.min.js",function(){AccountSettings.init(aJ,function(){aJ.show()},function(){Z($("#home-intro"))})},function(aK){h.makeNotice("error","misc-error",aK);Z($("#home-intro"))})},function(){Z($("#home-intro"))})})});$(".download-backup-btn").click(function(){window.open(root+"wallet/wallet.aes.json?guid="+L+"&sharedKey="+d)});$("#enable_archived_checkbox").change(function(){var aI=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aI);$("#archived-sweep").attr("disabled",!aI);$("#archived-delete").attr("disabled",!aI)});$("#anonymous-addresses").on("show",function(){var aI=$(this);loadScript("wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aI)})});$("#active-addresses").on("show",function(){var aO=$(this).find("table:first");aO.find("tbody:gt(0)").remove();var aL=aO.find("tbody").empty();for(var aN in H){var aP=H[aN];if(aP.tag==2){continue}var aM="";if(aP.tag==1){aM=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aP.priv==null){aM=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aI="";var aK=aP.addr;if(aP.label!=null){aK=aP.label;aI='<span class="hidden-phone"> - '+aP.addr+"</span>"}var aJ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aP.addr+'" target="new">'+aK+"</a>"+aI+" "+aM+'<div></td><td><span style="color:green">'+formatMoney(aP.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aQ){aJ.find(".act-archive").click(function(){h.archiveAddr(aQ)});aJ.find(".act-label").click(function(){loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aQ)})});aJ.find(".act-qr").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalQRCode(aQ)})});aJ.find(".act-sign").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalSignMessage(aQ)})});aJ.find(".act-request").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aQ+"</b>",src:root+"payment_request?address="+aQ})})})})(aP.addr);if(aP.balance>0&&aP.priv){aO.prepend(aJ)}else{aO.append(aJ)}}aq()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aJ=$(this).find("tbody");var aI=h.getArchivedAddresses();var aK=function(){aJ.empty();for(var aO in aI){var aQ=H[aI[aO]];if(aQ.tag!=2){continue}var aN="";if(aQ.priv==null){aN=' <font color="red">(Watch Only)</font>'}var aL="";var aM=aQ.addr;if(aQ.label!=null){aM=aQ.label;aL='<span class="hidden-phone"> - '+aQ.addr+"</span>"}var aP=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aQ.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aQ.addr+'" target="new">'+aM+"</a>"+aL+" "+aN+'<div></td><td><span style="color:green">'+formatBTC(aQ.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aR){aP.find(".act-unarchive").click(function(){h.unArchiveAddr(aR)})})(aQ.addr);if(aQ.balance>0&&aQ.priv){aJ.prepend(aP)}else{aJ.append(aP)}}};aK();BlockchainAPI.get_balances(aI,function(aL){aK()},function(aL){h.makeNotice("error","misc-error",aL)})});$("#archived-sweep").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){var aJ=H[$(this).val()];if(aJ.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aI.push(aJ.addr)});if(aI.length==0){return}N(aI)});$("#archived-delete").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){aI.push($(this).val())});if(aI.length==0){return}ag(aI)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$("#export-history").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})});$(".deposit-btn").click(function(){var aJ=$(this);var aI=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aJ.data("title"),description:"Deposit into address <b>"+aI+"</b>",top_right:'Have Questions? Read <a href="'+aJ.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aI+"&ptype="+aJ.data("type")+"&guid="+L+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aI=$(this);h.getSecondPassword(function(){var aJ=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aI.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(am)+" BTC</b>",src:root+"withdraw?method="+aI.data("type")+"&address="+aJ+"&balance="+am+"&guid="+L+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){I();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aJ=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aJ);loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aJ)});h.backupWallet()})}catch(aI){h.makeNotice("error","misc-error",aI)}});$("#filter").change(function(){ak=0;ah=$(this).val();h.get_history()});var aH=$("#tx_display");aH.change(function(){SetCookie("tx_display",$(this).val());c()});var aG=getCookie("tx_display");if(aG!=null){aH.val(parseInt(aG))}$("#email-backup-btn").click(function(){F()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+L+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+L+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"quick",initNewTx())})})});$("#send-email").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".mixer_fee").text(w);aI.find(".fees,.free,.bonus").show();if(w<0){aI.find(".fees,.free").hide()}else{if(w==0){aI.find(".fees,.bonus").hide()}else{aI.find(".free,.bonus").hide()}}aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"anonymous",initNewTx())})});aI.find(".anonymous-fees").text("0.00");aI.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aM=parseFloat($.trim($(this).val()));var aL=0;if(aM>0){if(w>0){aL=parseFloat(aM+((aM/100)*w))}else{aL=parseFloat(aM);aI.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*w)}}if(aM<0.5){aI.find(".anonymous-fees").text("0.00")}else{aI.find(".anonymous-fees").text(aL.toFixed(4))}aI.find('input[name="send-value"]').val(aL).trigger("keyup")})});$("#send-custom").on("show",function(aK,aJ){var aI=$(this);r(aI,aJ);aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aI,"custom",initNewTx())})});aI.find('select[name="from"]').unbind().change(function(){var aN=0;var aL=$(this).val();for(var aM in aL){if(aL[aM]=="any"){$(this).val("any");aN=am;break}else{var aO=H[aL[aM]];if(aO&&aO.balance){aN+=aO.balance}}}aI.find(".amount-available").text(formatBTC(aN))}).trigger("change");aI.find(".reset").unbind().click(function(){r(aI,true);aI.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aK,aJ){var aI=this;loadScript("wallet/dicegames.min.js",function(){try{DICEGame.init($(aI))}catch(aL){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aL){h.makeNotice("error","misc-error",aL)})});$("#send-sms").on("show",function(aK,aJ){if(aJ){return}var aI=$(this);r(aI);$.get(resource+"wallet/country_codes.html").success(function(aL){aI.find('select[name="sms-country-code"]').html(aL)}).error(function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});aI.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){var aL=initNewTx();startTxUI(aI,"sms",aL)})})});$("#address-book").on("show",function(){var aJ=$("#address-book-tbl tbody");if(ar(g)>0){aJ.empty();for(var aI in g){var aK=$("<tr><td>"+g[aI]+'</td><td><div class="addr-book-entry">'+aI+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aL){aK.find(".act-delete").click(function(){h.deleteAddressBook(aL)})})(aI);aJ.append(aK)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aI){$(aI.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){Z($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()})}function p(){$(".resend-code").click(function(){h.setGUID(L,true)});aq();$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aG){if(aG.keyCode==13){aG.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aH){aH.preventDefault();var aG=$.trim($("#restore-guid").val());if(aG.length==0){return}if(L!=aG){h.setGUID(aG,false)}else{a()}});$(".modal").on("show",function(){K();$(this).center()}).on("shown",function(){K();$(this).center()})}function ae(aH){var aI=Crypto.SHA256(aH+"?");switch(aI.slice(0,2)){case"00":var aJ=Crypto.SHA256(aH,{asBytes:true});return aJ;break;case"01":var aG=Crypto.util.hexToBytes(aI.slice(2,4))[0];var aK=Math.round(Math.pow(2,(aG/4)));var aJ=Crypto.PBKDF2(aH,"Satoshi Nakamoto",32,{iterations:aK,asBytes:true});return aJ;break;default:console.log("invalid key");break}}function av(){var aI,aG="";if(window.getSelection){aI=window.getSelection();if(aI.rangeCount){var aJ=aI.getRangeAt(0).cloneContents();var aH=document.createElement("div");aH.appendChild(aJ);aG=aH.innerText}}else{if(document.selection&&document.selection.type=="Text"){aG=document.selection.createRange().htmlText}}return aG}this.detectPrivateKeyFormat=function(aH){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aH)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aH)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aH)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aH)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aH)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aH)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aH)){var aG=Crypto.SHA256(aH+"?",{asBytes:true});if(aG[0]===0||aG[0]===1){return"mini"}}throw"Unknown Key Format "+aH};this.privateKeyStringToKey=function(aH,aJ){var aG=null;if(aJ=="base58"){aG=B58.decode(aH)}else{if(aJ=="base64"){aG=Crypto.util.base64ToBytes(aH)}else{if(aJ=="hex"){aG=Crypto.util.hexToBytes(aH)}else{if(aJ=="mini"){aG=ae(aH)}else{if(aJ=="sipa"){var aI=B58.decode(aH);aI.shift();aG=aI.slice(0,aI.length-4)}else{if(aJ=="sipa"){var aI=B58.decode(aH);aI.shift();aG=aI.slice(0,aI.length-4)}else{if(aJ=="compsipa"){var aI=B58.decode(aH);aI.shift();aI.pop();aG=aI.slice(0,aI.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aG.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aG)};$(document).ready(function(){var aH=$(document.body);aa=aH.data("payload");L=aH.data("guid");d=aH.data("sharedkey");an=aH.data("payload-checksum");q=aH.data("auth-type");if(h.skip_init){return}if(top.location!=self.location){top.location=self.location.href}if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");aH.ajaxStart(function(){$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){$(".loading-indicator").hide()}).click(function(){if(Q){clearTimeout(Q);Q=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(Q){clearTimeout(Q);Q=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aI=false;var aL=17,aK=86,aG=67,aJ=67;$(document).keydown(function(aN){try{if(aN.keyCode==aL||aN.keyCode==aJ){aI=true}if(aI&&aN.keyCode==aG){var aM=$.trim(av());var aO=H[aM];if(aO!=null){if(aO.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aO.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aN){console.log(aN)}}).keyup(function(aM){if(aM.keyCode==aL||aM.keyCode==aJ){aI=false}})});this.unArchiveAddr=function(aG){var aG=H[aG];if(aG.tag==2){aG.tag=null;c();ab("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aG){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aG=H[aG];if(aG.tag==null||aG.tag==0){aG.tag=2;c();ab("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aF(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aG){return aD(aG)};this.addPrivateKey=function(aH,aG){if(ac()){return false}if(aH==null){throw"Unable to generate a new bitcoin address."}if(aG){var aJ=aH.getBitcoinAddressCompressed()}else{var aJ=aH.getBitcoinAddress()}if(aJ==null){throw"Generated invalid bitcoin address."}if(aD(aJ.toString(),i(aH.priv))){H[aJ].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aJ+'"}')}catch(aI){}}else{throw"Unable to add generated bitcoin address."}return aJ};this.generateNewKey=function(){var aG=new Bitcoin.ECKey(false);if(h.addPrivateKey(aG)){return aG}}};
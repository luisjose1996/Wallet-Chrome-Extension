var MyWallet=new function(){var h=this;var z="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var X;var I;var j;var au;var aa;var t;var d;var ak=0;var L=0;var af=0;var G=0;var aE=0;var ar;var g={};var A=[];var B=false;var ai=0;var ae=0;var an=1000;var E=[];var al;var ac;var u=1.5;var av=0;var O=10;var ag=false;var b={};var N;var r=600000;var S=[];var x;var J=60000;var o;this.setHTML5Notifications=function(aG){ag=true};this.addEventListener=function(aG){S.push(aG)};this.getDoubleEncryption=function(){return B};this.getEncryptedWalletData=function(){return X};this.getFeePolicy=function(){return av};this.getGuid=function(){return I};this.setFeePolicy=function(aG){av=aG};this.getHTML5Notifications=function(){return ag};this.setHTML5Notifications=function(aG){ag=aG};this.getTransactions=function(){return A};this.addressExists=function(aG){return E[aG]!=null};this.getAddressTag=function(aG){return E[aG].tag};this.setAddressTag=function(aH,aG){E[aH].tag=aG};this.getAddressBook=function(){return g};this.getAddressLabel=function(aG){return E[aG].label};this.setAddressLabel=function(aG,aH){E[aG].label=aH};this.setAddressBalance=function(aG,aH){E[aG].balance=aH};this.getAddressBookLabel=function(aG){return g[aG]};this.isWatchOnly=function(aG){return E[aG].priv==null};this.getAddressBalance=function(aG){return E[aG].balance};this.getMixerFee=function(){return u};this.deleteAddress=function(aG){delete E[aG]};this.addAddressBookEntry=function(aH,aG){g[aH]=aG};this.getPrivateKey=function(aG){return E[aG].priv};this.setLabel=function(aG,aH){E[aG].label=aH;Y();c()};this.securePost=function(aG,aH){var aI=jQuery.extend({},aH);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aI.sharedKey=d;aI.guid=I;aI.format="plain";return $.post(root+aG,aI)};this.setDoubleEncryption=function(aJ){var aI=function(aL){console.log("Panic "+aL);window.location.reload()};try{if(B==aJ){return}if(aJ){var aG=$("#double-password").val();var aH=$("#double-password2").val();if(aG==null||aG.length==0||aG.length<4||aG.length>255){h.makeNotice("error","misc-error","Password must be 4 characters or more in length");return}if(aG!=aH){h.makeNotice("error","misc-error","Passwords do not match.");return}if(aG==au){h.makeNotice("error","misc-error","Second password should not be the same as your main password.");return}h.getSecondPassword(function(){try{B=true;aa=aG;for(var aN in E){var aP=E[aN];if(aP.priv!=null){aP.priv=i(B58.decode(aP.priv))}}var aL=Crypto.SHA256(d+aa,{asBytes:true});for(var aM=1;aM<O;++aM){aL=Crypto.SHA256(aL,{asBytes:true})}t=Crypto.util.bytesToHex(aL);aa=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aI(aQ)})}catch(aQ){aI(aQ)}},function(){aI()})}catch(aO){aI(aO)}},function(){aI()})}else{h.getSecondPassword(function(){try{for(var aL in E){var aN=E[aL];if(aN.priv!=null){aN.priv=h.decryptPK(aN.priv)}}B=false;aa=null;h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aI(aM)})}catch(aM){aI(aM)}},function(aL){aI(aL)})}}catch(aK){aI(aK)}};function H(){try{$(".pop").popover("hide")}catch(aG){}}$(window).resize(function(){$(".modal:visible").center();H()});this.setLoadingText=function(aG){$(".loading-text").text(aG)};function aC(aH,aG){aH.click(function(){w(aG.txIndex,aG.result)});aH.find(".show-note").mouseover(function(){var aI=aG.note?aG.note:b[aG.hash];ax(this,aI,aG.hash)});aH.find(".add-note").mouseover(function(){m(this,aG.hash)});return aH}function q(aH,aN){var aG=0;for(var aJ=0;aJ<aH.inputs.length;++aJ){var aI=aH.inputs[aJ].prev_out;var aM=E[aI.addr];if(aM){var aL=parseInt(aI.value);aG-=aL;if(aN){L+=aL;aM.balance-=aL}}}for(var aK=0;aK<aH.out.length;++aK){var aI=aH.out[aK];var aM=E[aI.addr];if(aM){var aL=parseInt(aI.value);aG+=aL;if(aN){af+=aL;aM.balance+=aL}}}return aG}function v(aG){aG.onmessage=function(aO){try{var aL=$.parseJSON(aO.data);if(aL.op=="status"){$("#status").html(aL.msg)}else{if(aL.op=="on_change"){var aP=Crypto.util.bytesToHex(Crypto.SHA256(X,{asBytes:true}));var aN=aL.checksum;console.log("On change old "+aP+" ==  new "+aN);if(aP!=aN){h.updateCacheManifest();setTimeout(F,250)}}else{if(aL.op=="utx"){var aM=TransactionFromJSON(aL.x);for(var aR in A){if(A[aR].txIndex==aM.txIndex){return}}var aT=q(aM,true);if(ag){var aK=function(aU){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aU.iconUrl,aU.title,aU.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aU.title,aU).show()}}}}catch(aV){}};try{aK({title:aT>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aT)+" BTC",iconUrl:resource+"cube48.png"})}catch(aO){console.log(aO)}}aM.result=aT;ak+=aT;G++;aM.setConfirmations(0);playSound("beep");if(ae==0&&ai==0){A.unshift(aM);var aQ=false;if(A.length>50){A.pop();aQ=true}}var aI=P();if("my-transactions"==aI){if(ae==0&&ai==0){$("#no-transactions").hide();if($("#tx_display").val()==0){var aH=$("#transactions-compact").show();aC($(y(aM,E,g)),aM).prependTo(aH.find("tbody")).find("div").hide().slideDown("slow");if(aQ){aH.find("tbody tr:last-child").remove()}}else{var aH=$("#transactions-detailed").show();aH.prepend(aM.getHTML(E,g));if(aQ){aH.find("div:last-child").remove()}}}}else{c()}}else{if(aL.op=="block"){for(var aJ=0;aJ<aL.x.txIndexes.length;++aJ){for(var aS=0;aS<A.length;++aS){if(A[aS].txIndex==aL.x.txIndexes[aJ]){if(A[aS].blockHeight==null||A[aS].blockHeight==0){A[aS].blockHeight=aL.x.height;break}}}}aj(BlockFromJSON(aL.x));R()}}}}}catch(aO){console.log(aO);console.log(aO.data)}};aG.onopen=function(){$("#status").html("CONNECTED.");var aK='{"op":"blocks_sub"}';if(I!=null){aK+='{"op":"wallet_sub","guid":"'+I+'"}'}try{var aI=h.getActiveAddresses();for(var aH in aI){aK+='{"op":"addr_sub", "addr":"'+aI[aH]+'"}'}}catch(aJ){alert(aJ)}aG.send(aK)};aG.onclose=function(){$("#status").html("DISCONNECTED.")}}this.makeNotice=function(aH,aK,aJ,aI){if(aJ==null||aJ.length==0){return}console.log(aJ);if(aI==null){aI=5000}var aG=$('<div class="alert alert-block alert-'+aH+'"></div>');aG.text(""+aJ);if($("#"+aK).length>0){aG.attr("id",aK);return}$("#notices").append(aG).hide().fadeIn(200);if(aI>0){(function(){var aL=aG;setTimeout(function(){aL.fadeOut(250,function(){$(this).remove()})},aI)})()}};function aq(aG){return aG}function ah(aG){return h.decryptPK(aG)}function U(aG){var aH=h.decodePK(aG);return Crypto.util.bytesToBase64(aH)}function k(aG){var aH=h.decodePK(aG);return Crypto.util.bytesToHex(aH)}this.base58ToSipa=function(aG,aL){var aH=h.decodePK(aG);var aI=new Bitcoin.ECKey(aH);while(aH.length<32){aH.unshift(0)}aH.unshift(128);if(aI.getBitcoinAddress().toString()==aL){}else{if(aI.getBitcoinAddressCompressed().toString()==aL){aH.push(1)}else{throw"Private Key does not match bitcoin address"+aL}}var aJ=Crypto.SHA256(Crypto.SHA256(aH,{asBytes:true}),{asBytes:true});aH=aH.concat(aJ.slice(0,4));var aK=B58.encode(aH);return aK};this.makeWalletJSON=function(aG){return aB(aG,I,d)};function aB(aK,aH,aN){var aJ=aq;if(aK=="base64"){aJ=U}else{if(aK=="hex"){aJ=k}else{if(aK=="sipa"){aJ=h.base58ToSipa}else{if(aK=="base58"){aJ=ah}}}}var aG='{\n	"guid" : "'+aH+'",\n	"sharedKey" : "'+aN+'",\n';if(B&&t!=null&&aJ==aq){aG+='	"double_encryption" : '+B+',\n	"dpasswordhash" : "'+t+'",\n'}if(av!=0){aG+='	"fee_policy" : '+av+",\n"}if(ag){aG+='	"html5_notifications" : '+ag+",\n"}aG+='	"keys" : [\n';var aL=false;for(var aI in E){var aM=E[aI];aG+='	{"addr" : "'+aM.addr+'"';if(aM.priv!=null){aG+=',\n	 "priv" : "'+aJ(aM.priv,aM.addr)+'"'}if(aM.tag==2){aG+=',\n	 "tag" : '+aM.tag}if(aM.label!=null){aG+=',\n	 "label" : "'+aM.label+'"'}aG+="},\n";aL=true}if(aL){aG=aG.substring(0,aG.length-2)}aG+="\n	]";if(ap(g)>0){aG+=',\n	"address_book" : [\n';for(var aI in g){aG+='	{"addr" : "'+aI+'",\n';aG+='	 "label" : "'+g[aI]+'"},\n'}aG=aG.substring(0,aG.length-2);aG+="\n	]"}if(ap(b)>0){aG+=',\n	"tx_notes" : '+JSON.stringify(b)}aG+="\n}";return aG}this.get_history=function(aH,aG){BlockchainAPI.get_history(function(aI){D(aI,false);c();if(aH){aH()}},function(){if(aG){aG()}},ae,ai)};this.deleteAddressBook=function(aG){delete g[aG];Y();$("#send-coins").find(".tab-pane").trigger("show",true)};function s(aG){$("#send-coins").find(".tab-pane.active").trigger("show",aG);if(aG){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aG,aH,aL){var aK=aG.val();aG.empty();for(var aJ in E){var aM=E[aJ];if(!aM||aM.tag==2){continue}var aI=aM.label;if(!aI){aI=aM.addr.substring(0,15)+"..."}if(aH||aM.balance>0){aG.prepend('<option value="'+aM.addr+'">'+aI+" - "+formatBTC(aM.balance)+" BTC</option>")}}aG.prepend('<option value="any" selected>Any Address</option>');if(!aL&&aK){aG.val(aK)}}function p(aI,aJ){l(aI.find('select[name="from"]'),false,aJ);l(aI.find('select[name="change"]'),true,aJ);aI.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aJ){aI.find("input").val("");aI.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aI.find(".amount-needed").text(0)}var aH=aI.find(".recipient-container");if(aJ){var aL=aH.find(".recipient:first-child").clone();aH.empty().append(aL)}function aG(){var aM=0;aI.find('input[name="send-value"]').each(function(){var aN=parseFloat($(this).val());if(!isNaN(aN)){aM+=aN}});return aM}function aK(aM){aM.find('input[name="send-to-address"]').val("").typeahead({source:am()});aM.find(".local-symbol").text(symbol_local.symbol);aM.find('input[name="send-value"]').val("").bind("keyup change",function(aN){if(aN.keyCode=="9"){return}aI.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aG().toFixed(8)).toString()));aM.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aM.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aN){if(aN.keyCode=="9"){return}aM.find(".send-value").val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aH.find(".recipient").each(function(){aK($(this))});aI.find(".remove-recipient").unbind().click(function(){var aM=aH.find(".recipient").length;if(aM>1){if(aM==2){$(this).hide(200)}aH.find(".recipient:last-child").remove()}});aI.find(".add-recipient").unbind().click(function(){var aM=aH.find(".recipient:first-child").clone();aM.appendTo(aH);aK(aM);aI.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aH=[];for(var aG in E){aH.push(aG)}return aH};this.getPreferredAddress=function(){var aH=null;for(var aG in E){var aI=E[aG];if(aH==null){aH=aI}if(aI.priv!=null){if(aH==null){aH=aI}if(aI.tag==null||aI.tag==0){aH=aI;break}}}return aH.addr};function Q(aG){var aJ=[];for(var aH in E){var aI=E[aH];if(aI.tag==aG){aJ.push(aI.addr)}}return aJ}this.getActiveAddresses=function(){return Q()};this.getArchivedAddresses=function(){return Q(2)};function aj(aJ){if(aJ!=null){ar=aJ;for(var aH in A){var aG=A[aH];if(aG.blockHeight!=null&&aG.blockHeight>0){var aI=ar.height-aG.blockHeight+1;if(aI<=100){aG.setConfirmations(ar.height-aG.blockHeight+1)}else{aG.setConfirmations(null)}}else{aG.setConfirmations(0)}}}}function w(aH,aG){loadScript(resource+"wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aH+"?result="+aG+"&guid="+I})})}this.deleteNote=function(aG){delete b[aG];c();Y()};function m(aG,aH){(function(aJ,aL){aJ=$(aJ);if(!aJ.data("popover")){aJ.popover({title:"Add Note",trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aJ.data("popover").tip().is(":visible")){return}}aJ.popover("show");aJ.mouseleave(function(){if(!aJ.__timeout){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)}});function aI(){if(aJ.__timeout){clearTimeout(aJ.__timeout);aJ.__timeout=null}}var aK=aJ.data("popover").tip().mouseenter(aI);aK.find("textarea").focus(aI);aK.mouseleave(function(){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)});aK.find("button").click(function(){var aM=$.trim($("<div>"+aK.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aM.length>0){b[aL]=aM;Y()}c()})})(aG,aH)}function ax(aG,aH,aI){(function(aJ,aK,aM){aJ=$(aJ);if(!aJ.data("popover")){var aN="Note";if(b[aM]){aN+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aJ).popover({title:aN,trigger:"manual",content:aK})}else{if(aJ.data("popover").tip().is(":visible")){return}}aJ.popover("show");aJ.mouseleave(function(){if(!aJ.__timeout){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)}});var aL=aJ.data("popover").tip().mouseenter(function(){if(aJ.__timeout){clearTimeout(aJ.__timeout);aJ.__timeout=null}});aL.find("img").unbind().click(function(){h.deleteNote(aM)});aL.mouseleave(function(){aJ.__timeout=setTimeout(function(){aJ.popover("hide")},250)})})(aG,aH,aI)}function y(aJ,aO,aL){var aP=aJ.result;var aK='<tr class="pointer" id="tx-'+aJ.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aH=true;if(aP>=0){for(var aI=0;aI<aJ.inputs.length;++aI){var aG=aJ.inputs[aI].prev_out;if(!aG||!aG.addr){aH=false;aK+='<span class="label">Newly Generated Coins</span>'}else{var aM=aO[aG.addr];if(aM){continue}aH=false;aK+=formatOutput(aG,aO,aL)}}}else{if(aP<0){for(var aI=0;aI<aJ.out.length;++aI){var aG=aJ.out[aI];var aM=aO[aG.addr];if(aM&&aG.type==0){continue}aH=false;aK+=formatOutput(aG,aO,aL)}}}if(aH){aK+='<span class="label">Moved Between Wallet</info>'}aK+="</ul></div></td><td><div>";var aN=aJ.note?aJ.note:b[aJ.hash];if(aN){aK+='<img src="'+resource+'note.png" class="pop show-note"> '}else{aK+='<img src="'+resource+'note_grey.png" class="pop add-note"> '}if(aJ.time>0){aK+=dateToString(new Date(aJ.time*1000))}if(aJ.confirmations==0){aK+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aJ.confirmations>0){aK+=' <span class="label label-info pull-right hidden-phone">'+aJ.confirmations+" Confirmations</span> "}}aK+="</div></td>";if(aP>0){aK+='<td style="color:green"><div>'+formatMoney(aP,true)+"</div></td>"}else{if(aP<0){aK+='<td style="color:red"><div>'+formatMoney(aP,true)+"</div></td>"}else{aK+="<td><div>"+formatMoney(aP,true)+"</div></td>"}}if(aJ.balance==null){aK+="<td></td></tr>"}else{aK+='<td class="hidden-phone"><div>'+formatMoney(aJ.balance)+"</div></td></tr>"}return aK}function P(){H();if(ak==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(ak,symbol));$("#balance2").html(formatSymbol(ak,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aG){var aH=P();if("send-coins"==aH){s(aG)}else{if("home-intro"==aH){f(aG)}else{if("receive-coins"==aH){aF(aG)}else{if("my-transactions"==aH){R(aG)}}}}}function f(aG){$("#summary-n-tx").html(G);$("#summary-received").html(formatMoney(af,true));$("#summary-sent").html(formatMoney(L,true));$("#summary-balance").html(formatMoney(ak,symbol));var aI=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aI+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aI)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aH=$("#my-primary-address");if(aH.text()!=aI){aH.text(aI);$("#my-primary-addres-qr-code").html('<img style="padding-right:10px;padding-bottom:10px" src="'+root+"qr?data="+aI+'&size=125">')}}}function M(){var aG=$("#export-warning").show();var aH=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aG.hide();loadScript(resource+"wallet/import-export.min.js",function(){ImportExport.init(aH,function(){aH.show()},function(){W($("#home-intro"))})},function(aI){h.makeNotice("error","misc-error",aI);W($("#home-intro"))})},function(){W($("#home-intro"))})})}function R(){var aJ=$("#tx_display").val();var aH=null;var aK=0;if(aH!=null){clearInterval(aH);aH=null}var aG;if(aJ==0){$("#transactions-detailed").hide();aG=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aG=$("#transactions-detailed").empty().show()}if(A.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aI=function(){for(var aO=aK;aO<A.length&&aO<(aK+10);++aO){var aN=A[aO];if(aJ==0){aG.append(aC($(y(aN,E,g)),aN))}else{aG.append(aN.getHTML(E,g))}}aK+=10;if(aK<A.length){aH=setTimeout(aI,15)}else{var aM=$(".pagination ul").empty();if(ai==0&&A.length<50){aM.hide();return}else{aM.show()}var aL=Math.ceil(aE/50);var aP=" disabled";if(ai>0){aP=""}aM.append($('<li class="prev'+aP+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(ai-1)}));for(var aO=0;aO<aL&&aO<=10;++aO){(function(aQ){var aR="";if(ai==aQ){aR=' class="active"'}aM.append($("<li"+aR+'><a class="hidden-phone">'+aQ+"</a></li>").click(function(){h.setPage(aQ)}))})(aO)}var aP=" disabled";if(ai<aL){aP=""}aM.append($('<li class="next'+aP+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(ai+1)}))}};aI()}this.setPage=function(aG){ai=aG;scroll(0,0);h.get_history()};function D(aI,aJ){var aL=$.parseJSON(aI);if(!aJ&&aL.mixer_fee){u=aL.mixer_fee}A.length=0;if(aL.wallet==null){af=0;L=0;ak=0;G=0;aE=0;return}af=aL.wallet.total_received;L=aL.wallet.total_sent;ak=aL.wallet.final_balance;G=aL.wallet.n_tx;aE=aL.wallet.n_tx_filtered;for(var aH=0;aH<aL.addresses.length;++aH){if(E[aL.addresses[aH].address]){E[aL.addresses[aH].address].balance=aL.addresses[aH].final_balance}}for(var aH=0;aH<aL.txs.length;++aH){var aG=TransactionFromJSON(aL.txs[aH]);aG.result=q(aG,false);A.push(aG)}if(aL.info){$("#nodes-connected").html(aL.info.nconnected);if(aL.info.latest_block!=null){aj(aL.info.latest_block)}var aK=aL.info.symbol_local;if(symbol==symbol_local){symbol_local=aK;symbol=aK;calcMoney()}else{if(!aJ){symbol_local=aK}}}}function az(){N=setTimeout(h.logout,r);for(var aI in S){S[aI]("did_decrypt")}window.location.hash="";try{var aG=localStorage.getItem("guid");if(aG!=I){localStorage.clear();if(I!=z){localStorage.setItem("guid",I)}}else{var aH=localStorage.getItem("multiaddr");if(aH!=null){D(aH,true);c()}}}catch(aJ){}h.get_history();W($("#home-intro"));$("#initial_error,#initial_success").remove()}function F(){for(var aG in E){var aH=E[aG];if(aH.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+al);$.get(root+"wallet/wallet.aes.json?guid="+I+"&sharedKey="+d+"&checksum="+al+"&format=plain").success(function(aI){if(aI==null||aI.length==0){return}if(aI=="Not modified"){console.log("Not modified");return}else{console.log("Wallet data modified");X=aI;al=Crypto.util.bytesToHex(Crypto.SHA256(X,{asBytes:true}));T();h.get_history();c()}})}function T(){try{if(X==null||X.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aJ=null;h.decrypt(X,au,function(aK){try{aJ=$.parseJSON(aK);return(aJ!=null)}catch(aL){return false}});if(aJ==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aJ.double_encryption&&aJ.dpasswordhash){B=aJ.double_encryption;t=aJ.dpasswordhash}if(aJ.fee_policy){av=aJ.fee_policy}if(aJ.html5_notifications){ag=aJ.html5_notifications}E.length=0;for(var aH=0;aH<aJ.keys.length;++aH){var aG=aJ.keys[aH];if(aG.addr==null||aG.addr.length==0||aG.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}E[aG.addr]=aG}g={};if(aJ.address_book!=null){for(var aH=0;aH<aJ.address_book.length;++aH){h.addAddressBookEntry(aJ.address_book[aH].addr,aJ.address_book[aH].label)}}if(aJ.tx_notes){b=aJ.tx_notes}d=aJ.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(al==null||al.length==0){al=Crypto.util.bytesToHex(Crypto.SHA256(X,{asBytes:true}))}else{F()}e();return true}catch(aI){h.makeNotice("error","misc-error",aI)}return false}this.getPassword=function(aL,aM,aJ){aL.modal({keyboard:true,backdrop:"static",show:true});aL.center();var aI=aL.find('input[name="password"]');var aH=aI,aG=false,aK=false;aL.find(".vkeyboard li").click(function(){var aP=$(this),aO=aP.html();if(aP.hasClass("left-shift")||aP.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aG=(aG===true)?false:true;aK=false;return false}if(aP.hasClass("capslock")){$(".letter").toggleClass("uppercase");aK=true;return false}if(aP.hasClass("delete")){var aN=aH.val();aH.val(aN.substr(0,aN.length-1));return false}if(aP.hasClass("symbol")){aO=$("span:visible",aP).html()}if(aP.hasClass("space")){aO=" "}if(aP.hasClass("tab")){aO="\t"}if(aP.hasClass("return")){aO="\n"}if(aP.hasClass("uppercase")){aO=aO.toUpperCase()}if(aG===true){$(".symbol span").toggle();if(aK===false){$(".letter").toggleClass("uppercase")}aG=false}aH.val(aH.val()+aO)});aI.unbind().keypress(function(aN){if(aN.keyCode==13){aN.preventDefault();aL.find(".btn.btn-primary").click()}});aI.val("");aL.find(".btn.btn-primary").unbind().click(function(){if(aM){aJ=null;var aN=aM;aM=null;aL.modal("hide");setTimeout(function(){aN(aI.val())},100)}});aL.find(".btn.btn-secondary").unbind().click(function(){if(aJ){var aN=aJ;aJ=null;setTimeout(function(){try{aN()}catch(aO){h.makeNotice("error","misc-error",aO)}},100)}aL.modal("hide")});aL.unbind().on("hidden",function(){if(aJ){var aN=aJ;aJ=null;setTimeout(function(){try{aN()}catch(aO){h.makeNotice("error","misc-error",aO)}},100)}})};this.makePairingQRCode=function(aG){h.getMainPassword(function(){loadScript(resource+"wallet/qr.code.creator.js",function(){try{var aH=makeQRCode(300,300,1,I+"|"+d+"|"+au);aG(aH)}catch(aI){h.makeNotice("error","misc-error",aI)}})},function(){h.logout()})};this.getMainPassword=function(aH,aG){if(x>new Date().getTime()-J){return aH(au)}h.getPassword($("#main-password-modal"),function(aI){if(au==aI){x=new Date().getTime();if(aH){try{aH(au)}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aG){try{aG()}catch(aJ){h.makeNotice("error","misc-error",aJ)}}}},aG)};this.getSecondPassword=function(aI,aG){if(!B||aa!=null){if(aI){try{aI(aa)}catch(aH){h.makeNotice("error","misc-error",aH)}}return}h.getPassword($("#second-password-modal"),function(aJ){if(aw(aJ)){if(aI){try{aI(aJ)}catch(aK){h.makeNotice("error","misc-error",aK)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aG){try{aG()}catch(aK){h.makeNotice("error","misc-error",aK)}}}},aG)};function a(){var aG=$("#restore-password");au=$.trim(aG.val());aG.val("");x=new Date().getTime();if(X==null||X.length==0){h.setLoadingText("Validating Authentication key");var aH=$.trim($(".restore-auth-"+o).find(".code").val());if(aH.length==0||aH.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.post(root+"wallet",{guid:I,payload:aH,length:aH.length,method:"get-wallet",format:"plain"},function(aI){try{if(aI==null||aI.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}X=aI;$(".restore-auth-"+o).hide();$(".restore-auth-0").show();if(T()){az()}}catch(aJ){h.makeNotice("error","misc-error",aJ)}}).error(function(aI){h.makeNotice("error","misc-error",aI.responseText)})}else{if(T()){az()}}return true}function e(){webSocketConnect(v);$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show();$("#status-container").show()}this.quickSendNoUI=function(aI,aH,aG){loadScript(resource+"wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aK=initNewTx();aK.from_addresses=h.getActiveAddresses();aK.to_addresses.push({address:new Bitcoin.Address(aI),value:Bitcoin.Util.parseValue(aH)});aK.addListener(aG);aK.start()}catch(aJ){aG.on_error(aJ)}},function(aJ){aG.on_error(aJ)})})};function C(){h.setLoadingText("Sending email backup");$.post(root+"wallet",{guid:I,sharedKey:d,method:"email-backup",format:"plain"},function(aG){h.makeNotice("success","backup-success",aG)}).error(function(aG){h.makeNotice("error","misc-error",aG.responseText)})}this.updateCacheManifest=function(aG){try{var aH=window.applicationCache;console.log("Clear Cache Manifest");aH.addEventListener("updateready",function(aJ){aH.swapCache();if(aG){aG()}},false);aH.addEventListener("noupdate",function(aJ){if(aG){aG()}},false);aH.addEventListener("error",function(aJ){if(aG){aG()}},false);aH.update()}catch(aI){console.log(aI);if(aG){aG()}}};function Y(aJ,aI,aH,aG){if(ac!=null){clearInterval(ac);ac=null}ac=setTimeout(function(){h.backupWallet(aJ,aI,aH,aG)},3000)}this.insertWallet=function(aN,aP,aQ,aG,aI,aO){try{var aJ=aB(null,aN,aP);var aM=h.encrypt(aJ,aQ);if(aM.length==0){throw"Error encrypting the JSON output"}var aH=null;h.decrypt(aM,aQ,function(aR){try{aH=$.parseJSON(aR);return(aH!=null)}catch(aS){return false}});if(aH==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aK=Crypto.util.bytesToHex(Crypto.SHA256(aM,{asBytes:true}));h.setLoadingText("Saving wallet");if(aG==null){aG=""}X=aM;$.ajax({type:"POST",url:root+"wallet"+aG,data:{guid:aN,length:aM.length,payload:aM,sharedKey:aP,checksum:aK,method:"insert"},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aS){var aU=false;for(var aR in E){var aT=E[aR];if(aT.tag==1){aT.tag=null;aU=true}}al=aK;h.makeNotice("success","misc-success",aS);c();if(aI!=null){aI()}h.updateCacheManifest()},error:function(aR){h.makeNotice("error","misc-error",aR.responseText,10000);c();if(aO!=null){aO()}}})}catch(aL){h.makeNotice("error","misc-error","Error Saving Wallet: "+aL,10000);c();if(aO!=null){aO(aL)}else{throw aL}}};this.backupWallet=function(aN,aM,aG){try{if(aN==null){aN="update"}if(ap(E)==0){return}var aI=h.makeWalletJSON();var aL=h.encrypt(aI,au);if(aL.length==0){throw"Error encrypting the JSON output"}var aK=null;h.decrypt(aL,au,function(aO){try{aK=$.parseJSON(aO);return(aK!=null)}catch(aP){return false}});if(aK==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aH=Crypto.util.bytesToHex(Crypto.SHA256(aL,{asBytes:true}));h.setLoadingText("Saving wallet");X=aL;$.ajax({type:"POST",url:root+"wallet",data:{guid:I,length:aL.length,payload:aL,sharedKey:d,checksum:aH,old_checksum:al,method:aN},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aP){var aR=false;for(var aO in E){var aQ=E[aO];if(aQ.tag==1){aQ.tag=null;aR=true}}al=aH;h.makeNotice("success","misc-success",aP);c();if(aM!=null){aM()}h.updateCacheManifest()},error:function(aO){h.makeNotice("error","misc-error",aO.responseText,10000);c();if(errorcallback!=null){errorcallback()}}})}catch(aJ){h.makeNotice("error","misc-error","Error Saving Wallet: "+aJ,10000);c();if(errorcallback!=null){errorcallback(aJ)}else{throw aJ}}};function aA(aG){if(B){if(aa==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aG,d+aa)}else{return aG}return null}this.isBase58=function(aI,aH){for(var aG=0;aG<aI.length;++aG){if(aI[aG]<0||aI[aG]>58){return false}}return true};this.encrypt=function(aH,aG){return Crypto.AES.encrypt(aH,aG,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:O})};this.decrypt=function(aJ,aI,aL,aH){try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:O});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}try{var aG=Crypto.AES.decrypt(aJ,aI,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aG!=null&&aG.length>0){if(aL(aG)){return aG}}}catch(aK){console.log(aK)}if(aH!=null){aH()}return null};this.setGUID=function(aH,aG){h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();$.get(root+"wallet/"+aH,{format:"json",resend_code:aG}).success(function(aJ){$(".restore-auth-"+o).hide();I=aJ.guid;o=aJ.auth_type;al=aJ.payload_checksum;X=aJ.payload;war_checksum=aJ.war_checksum;symbol_local=aJ.symbol_local;$("#restore-guid").val(I);$(".restore-auth-"+o).show();if(aJ.initial_error){h.makeNotice("error","misc-error",aJ.initial_error)}if(aJ.initial_success){h.makeNotice("success","misc-success",aJ.initial_success)}try{localStorage.clear();if(I!=z){localStorage.setItem("guid",I)}}catch(aI){}}).error(function(aJ){console.log(aJ);try{var aI=$.parseJSON(aJ.responseText);if(aI.initial_error){h.makeNotice("error","misc-error",aI.initial_error);return}}catch(aJ){}h.makeNotice("error","misc-error","Error changing wallet identifier")})};function i(aG){var aH=B58.encode(aG);return aA(aH)}this.decryptPK=function(aG){if(B){if(aa==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aG,d+aa,h.isBase58)}else{return aG}return null};this.decodePK=function(aH){var aG=h.decryptPK(aH);if(aG!=null){return B58.decode(aG)}return null};this.signmessage=function(aG,aI){var aK=E[aG];var aJ=h.decodePK(aK.priv);var aH=new Bitcoin.ECKey(aJ);return Bitcoin.Message.signMessage(aH,aI,aK.addr)};function aw(aH){var aG=Crypto.SHA256(d+aH,{asBytes:true});var aJ=aG;for(var aI=1;aI<O;++aI){aJ=Crypto.SHA256(aJ,{asBytes:true})}var aL=Crypto.util.bytesToHex(aJ);if(aL==t){aa=aH;return true}if(Crypto.util.bytesToHex(aG)==t){aa=aH;t=aL;return true}var aK=Crypto.SHA256(aH);if(aK==t){aa=aH;t=aL;return true}return false}this.checkAllKeys=function(aG){for(var aH in E){var aL=E[aH];if(aL.addr==null){throw"Null Address Found in wallet "+aH}if(aL.addr.toString()==null){throw"Error decoding wallet address "+aL.addr}if(aL.priv!=null){var aK=h.decodePK(aL.priv);var aJ=new Bitcoin.ECKey(aK);var aI=aJ.getBitcoinAddress().toString();if(aI!=aL.addr&&aJ.getBitcoinAddressCompressed().toString()!=aL.addr){throw"Private key does not match bitcoin address "+aL.addr+" != "+aI}if(aG){aL.priv=i(aK)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aG){h.getMainPassword(function(){au=aG;h.backupWallet("update",function(){h.updateCacheManifest(function(){h.logout()})},function(){h.logout()})})};function W(aG){if(aG===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aG;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function ap(aI){var aH=0,aG;for(aG in aI){aH++}return aH}function V(aG){E[aG].priv=null}function Z(){if(ap(E)>=an){h.makeNotice("error","misc-error","We currently support a maximum of "+an+" private keys, please remove some unused ones.");return true}return false}function aD(aI,aG){var aH=E[aI];if(!aH||aH.length==0){E[aI]={addr:aI,priv:aG,balance:0};return true}else{if(!aH.priv&&aG){aH.priv=aG;return true}}return false}function n(){var aI=$("#add-address-book-entry-modal");aI.modal({keyboard:true,backdrop:"static",show:true});var aG=aI.find('input[name="label"]');var aH=aI.find('input[name="address"]');aG.val("");aH.val("");aI.find(".btn.btn-primary").unbind().click(function(){aI.modal("hide");var aK=$.trim($("<div>"+aG.val()+"</div>").text());var aJ=$.trim(aH.val());if(aK.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aK.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aJ.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aM;try{aM=new Bitcoin.Address(aJ);if(aM==null){throw"Null address"}}catch(aL){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aJ]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aJ,aK);Y();$("#send-coins").find(".tab-pane").trigger("show",true)});aI.find(".btn.btn-secondary").unbind().click(function(){aI.modal("hide")})}this.logout=function(){window.location=root+"wallet/logout"};function ad(aM){var aO=$("#delete-address-modal");aO.modal({keyboard:true,backdrop:"static",show:true});aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();$("#change-mind").hide();aO.find("#to-delete-address").html(aM.join(" "));aO.find("#delete-balance").empty();var aI=aO.find("#delete-balance");var aG=[];for(var aL in aM){var aN=aM[aL];if(E[aN]&&E[aN].priv){aG.push(aM[aL])}}BlockchainAPI.get_balance(aG,function(aP){aO.find(".btn.btn-primary").show(200);aO.find(".btn.btn-danger").show(200);aI.html("Balance "+formatBTC(aP)+" BTC");if(aP>0){aI.css("color","red")}else{aI.css("color","black")}},function(){aO.find(".btn.btn-primary").show(200);aO.find(".btn.btn-danger").show(200);aI.text("Error Fetching Balance")});var aJ=false;var aL=0;var aH=null;var aK=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aK-aL)};aO.find(".btn.btn-primary").unbind().click(function(){changeMind();aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();aH=setInterval(function(){if(aJ){return}++aL;changeMind();if(aL==aK){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aP in aM){V(aM[aP])}c();h.backupWallet();clearInterval(aH)}},1000)});aO.find(".btn.btn-danger").unbind().click(function(){changeMind();aO.find(".btn.btn-primary").hide();aO.find(".btn.btn-danger").hide();aH=setInterval(function(){if(aJ){return}++aL;changeMind();if(aL==aK){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aP in aM){h.deleteAddress(aM[aP])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aH)}}},1000)});aO.unbind().on("hidden",function(){if(aH){aJ=true;clearInterval(aH);aH=null}});aO.find(".btn.btn-secondary").unbind().click(function(){aO.modal("hide")})}function am(){var aI=[];for(var aG in g){aI.push(g[aG])}for(var aG in E){var aH=E[aG];if(aH.tag!=2&&aH.label){aI.push(aH.label)}}return aI}function K(aG){h.getSecondPassword(function(){var aI=$("#sweep-address-modal");aI.modal("show");BlockchainAPI.get_balance(aG,function(aJ){aI.find(".balance").text("Amount: "+formatBTC(aJ)+" BTC")},function(){aI.find(".balance").text("Error Fetching Balance")});var aH=aI.find('select[name="change"]');l(aH,true);aI.find(".btn.btn-primary").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){BlockchainAPI.get_balance(aG,function(aJ){var aK=initNewTx();aK.fee=aK.base_fee;aK.to_addresses.push({address:new Bitcoin.Address($.trim(aH.val())),value:BigInteger.valueOf(aJ).subtract(aK.fee)});aK.from_addresses=aG;aK.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aI.modal("hide")});aI.find(".btn.btn-secondary").unbind().click(function(){aI.modal("hide")})})}function ao(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aG){}}function ay(){$(".resend-code").click(function(){h.setGUID(I,true)});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript(resource+"wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript(resource+"wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aI){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});ao();$(".download-backup-btn").click(function(){window.open(root+"wallet/wallet.aes.json?guid="+I+"&sharedKey="+d)});$("#logout").click(h.logout);$("#refresh").click(function(){F();h.get_history()});$("#enable_archived_checkbox").change(function(){var aI=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aI);$("#archived-sweep").attr("disabled",!aI);$("#archived-delete").attr("disabled",!aI)});$("#anonymous-addresses").on("show",function(){var aI=$(this);loadScript(resource+"wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aI)})});$("#active-addresses").on("show",function(){var aO=$(this).find("table:first");aO.find("tbody:gt(0)").remove();var aL=aO.find("tbody").empty();for(var aN in E){var aP=E[aN];if(aP.tag==2){continue}var aM="";if(aP.tag==1){aM=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aP.priv==null){aM=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aI="";var aK=aP.addr;if(aP.label!=null){aK=aP.label;aI='<span class="hidden-phone"> - '+aP.addr+"</span>"}var aJ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aP.addr+'" target="new">'+aK+"</a>"+aI+" "+aM+'<div></td><td><span style="color:green">'+formatMoney(aP.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aQ){aJ.find(".act-archive").click(function(){h.archiveAddr(aQ)});aJ.find(".act-label").click(function(){loadScript(resource+"wallet/address_modal.min.js",function(){showLabelAddressModal(aQ)})});aJ.find(".act-qr").click(function(){loadScript(resource+"wallet/address_modal.min.js",function(){showAddressModalQRCode(aQ)})});aJ.find(".act-sign").click(function(){loadScript(resource+"wallet/address_modal.min.js",function(){showAddressModalSignMessage(aQ)})});aJ.find(".act-request").click(function(){loadScript(resource+"wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aQ+"</b>",src:root+"payment_request?address="+aQ})})})})(aP.addr);if(aP.balance>0&&aP.priv){aO.prepend(aJ)}else{aO.append(aJ)}}ao()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aJ=$(this).find("tbody");var aI=h.getArchivedAddresses();var aK=function(){aJ.empty();for(var aO in aI){var aQ=E[aI[aO]];if(aQ.tag!=2){continue}var aN="";if(aQ.priv==null){aN=' <font color="red">(Watch Only)</font>'}var aL="";var aM=aQ.addr;if(aQ.label!=null){aM=aQ.label;aL='<span class="hidden-phone"> - '+aQ.addr+"</span>"}var aP=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aQ.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aQ.addr+'" target="new">'+aM+"</a>"+aL+" "+aN+'<div></td><td><span style="color:green">'+formatBTC(aQ.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aR){aP.find(".act-unarchive").click(function(){h.unArchiveAddr(aR)})})(aQ.addr);if(aQ.balance>0&&aQ.priv){aJ.prepend(aP)}else{aJ.append(aP)}}};aK();BlockchainAPI.get_balances(aI,function(aL){aK()},function(aL){h.makeNotice("error","misc-error",aL)})});$("#archived-sweep").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){var aJ=E[$(this).val()];if(aJ.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aI.push(aJ.addr)});if(aI.length==0){return}K(aI)});$("#archived-delete").click(function(){var aI=[];$(".archived_checkbox:checked").each(function(){aI.push($(this).val())});if(aI.length==0){return}ad(aI)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$("#export-history").click(function(){loadScript(resource+"wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})});$(".deposit-btn").click(function(){var aJ=$(this);var aI=h.getPreferredAddress();loadScript(resource+"wallet/frame-modal.js",function(){showFrameModal({title:aJ.data("title"),description:"Deposit into address <b>"+aI+"</b>",top_right:'Have Questions? Read <a href="'+aJ.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aI+"&ptype="+aJ.data("type")+"&guid="+I+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aI=$(this);h.getSecondPassword(function(){var aJ=h.getPreferredAddress();loadScript(resource+"wallet/frame-modal.js",function(){showFrameModal({title:aI.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(ak)+" BTC</b>",src:root+"withdraw?method="+aI.data("type")+"&address="+aJ+"&balance="+ak+"&guid="+I+"&sharedKey="+d})})})});$("#restore-password").keypress(function(aI){if(aI.keyCode==13){aI.preventDefault();$("#restore-wallet-continue").click()}});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aJ=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aJ);loadScript(resource+"wallet/address_modal.min.js",function(){showLabelAddressModal(aJ)});h.backupWallet()})}catch(aI){h.makeNotice("error","misc-error",aI)}});$("#filter").change(function(){ai=0;ae=$(this).val();h.get_history()});var aH=$("#tx_display");aH.change(function(){SetCookie("tx_display",$(this).val());c()});var aG=getCookie("tx_display");if(aG!=null){aH.val(parseInt(aG))}$("#email-backup-btn").click(function(){C()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+I+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+I+"&sharedKey="+d)});$("#restore-wallet-continue").unbind().click(function(aJ){aJ.preventDefault();var aI=$.trim($("#restore-guid").val());if(aI.length==0){return}if(I!=aI){h.setGUID(aI,false)}else{a()}});$("#add-address-book-entry-btn").click(function(){n()});$("#home-intro-btn").click(function(){W($("#home-intro"))});$("#my-transactions-btn").click(function(){W($("#my-transactions"))});$("#send-coins-btn").click(function(){W($("#send-coins"))});$("#import-export-btn").click(function(){W($("#import-export"));M()});$("#my-account-btn").click(function(){W($("#my-account"));var aI=$("#account-settings-warning").show();var aJ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aI.hide();loadScript(resource+"wallet/account.min.js",function(){AccountSettings.init(aJ,function(){aJ.show()},function(){W($("#home-intro"))})},function(aK){h.makeNotice("error","misc-error",aK);W($("#home-intro"))})},function(){W($("#home-intro"))})})});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aK,aJ){var aI=$(this);p(aI,aJ);aI.find(".send").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){startTxUI(aI,"quick",initNewTx())})})});$("#send-email").on("show",function(aK,aJ){var aI=$(this);p(aI,aJ);aI.find(".send").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){startTxUI(aI,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aK,aJ){var aI=$(this);p(aI,aJ);aI.find(".mixer_fee").text(u);aI.find(".fees,.free,.bonus").show();if(u<0){aI.find(".fees,.free").hide()}else{if(u==0){aI.find(".fees,.bonus").hide()}else{aI.find(".free,.bonus").hide()}}aI.find(".send").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){startTxUI(aI,"anonymous",initNewTx())})});aI.find(".anonymous-fees").text("0.00");aI.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aM=parseFloat($.trim($(this).val()));var aL=0;if(aM>0){if(u>0){aL=parseFloat(aM+((aM/100)*u))}else{aL=parseFloat(aM);aI.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*u)}}if(aM<0.5){aI.find(".anonymous-fees").text("0.00")}else{aI.find(".anonymous-fees").text(aL.toFixed(4))}aI.find('input[name="send-value"]').val(aL).trigger("keyup")})});$("#send-custom").on("show",function(aK,aJ){var aI=$(this);p(aI,aJ);aI.find(".send").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){startTxUI(aI,"custom",initNewTx())})});aI.find('select[name="from"]').unbind().change(function(){var aN=0;var aL=$(this).val();for(var aM in aL){if(aL[aM]=="any"){$(this).val("any");aN=ak;break}else{var aO=E[aL[aM]];if(aO&&aO.balance){aN+=aO.balance}}}aI.find(".amount-available").text(formatBTC(aN))}).trigger("change");aI.find(".reset").unbind().click(function(){p(aI,true);aI.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aK,aJ){var aI=this;loadScript(resource+"wallet/dicegames.min.js",function(){DICEGame.init($(aI))},function(aL){h.makeNotice("error","misc-error",aL)})});$("#send-sms").on("show",function(aK,aJ){if(aJ){return}var aI=$(this);p(aI);$.get(resource+"wallet/country_codes.html").success(function(aL){aI.find('select[name="sms-country-code"]').html(aL)}).error(function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});aI.find(".send").unbind().click(function(){loadScript(resource+"wallet/signer.min.js",function(){var aL=initNewTx();startTxUI(aI,"sms",aL)})})});$("#address-book").on("show",function(){var aJ=$("#address-book-tbl tbody");if(ap(g)>0){aJ.empty();for(var aI in g){var aK=$("<tr><td>"+g[aI]+'</td><td><div class="addr-book-entry">'+aI+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aL){aK.find(".act-delete").click(function(){h.deleteAddressBook(aL)})})(aI);aJ.append(aK)}}});$('a[data-toggle="tab"]').on("show",function(aI){$(aI.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){W($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".modal").on("show",function(){H();$(this).center()}).on("shown",function(){H();$(this).center()})}function ab(aH){var aI=Crypto.SHA256(aH+"?");switch(aI.slice(0,2)){case"00":var aJ=Crypto.SHA256(aH,{asBytes:true});return aJ;break;case"01":var aG=Crypto.util.hexToBytes(aI.slice(2,4))[0];var aK=Math.round(Math.pow(2,(aG/4)));var aJ=Crypto.PBKDF2(aH,"Satoshi Nakamoto",32,{iterations:aK,asBytes:true});return aJ;break;default:console.log("invalid key");break}}function at(){var aI,aG="";if(window.getSelection){aI=window.getSelection();if(aI.rangeCount){var aJ=aI.getRangeAt(0).cloneContents();var aH=document.createElement("div");aH.appendChild(aJ);aG=aH.innerText}}else{if(document.selection&&document.selection.type=="Text"){aG=document.selection.createRange().htmlText}}return aG}this.detectPrivateKeyFormat=function(aH){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aH)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aH)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aH)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aH)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aH)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aH)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aH)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aH)){var aG=Crypto.SHA256(aH+"?",{asBytes:true});if(aG[0]===0||aG[0]===1){return"mini"}}throw"Unknown Key Format "+aH};this.privateKeyStringToKey=function(aH,aJ){var aG=null;if(aJ=="base58"){aG=B58.decode(aH)}else{if(aJ=="base64"){aG=Crypto.util.base64ToBytes(aH)}else{if(aJ=="hex"){aG=Crypto.util.hexToBytes(aH)}else{if(aJ=="mini"){aG=ab(aH)}else{if(aJ=="sipa"){var aI=B58.decode(aH);aI.shift();aG=aI.slice(0,aI.length-4)}else{if(aJ=="sipa"){var aI=B58.decode(aH);aI.shift();aG=aI.slice(0,aI.length-4)}else{if(aJ=="compsipa"){var aI=B58.decode(aH);aI.shift();aI.pop();aG=aI.slice(0,aI.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aG.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aG)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input, button").attr("autocomplete","off");var aH=$(document.body);aH.ajaxStart(function(){$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){$(".loading-indicator").hide()}).click(function(){if(N){clearTimeout(N);N=setTimeout(h.logout,r)}rng_seed_time()}).keypress(function(){if(N){clearTimeout(N);N=setTimeout(h.logout,r)}rng_seed_time()});ay();X=aH.data("payload");I=aH.data("guid");d=aH.data("sharedkey");al=aH.data("payload-checksum");o=aH.data("auth-type");$(".restore-auth-"+o).show();j=$("#restore-wallet");j.show();var aI=false;var aL=17,aK=86,aG=67,aJ=67;$(document).keydown(function(aN){try{if(aN.keyCode==aL||aN.keyCode==aJ){aI=true}if(aI&&aN.keyCode==aG){var aM=$.trim(at());var aO=E[aM];if(aO!=null){if(aO.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aO.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aN){console.log(aN)}}).keyup(function(aM){if(aM.keyCode==aL||aM.keyCode==aJ){aI=false}})});this.unArchiveAddr=function(aG){var aG=E[aG];if(aG.tag==2){aG.tag=null;c();Y("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aG){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aG=E[aG];if(aG.tag==null||aG.tag==0){aG.tag=2;c();Y("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aF(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aG){return aD(aG)};this.addPrivateKey=function(aH,aG){if(Z()){return false}if(aH==null){throw"Unable to generate a new bitcoin address."}if(aG){var aJ=aH.getBitcoinAddressCompressed()}else{var aJ=aH.getBitcoinAddress()}if(aJ==null){throw"Generated invalid bitcoin address."}if(aD(aJ.toString(),i(aH.priv))){E[aJ].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aJ+'"}')}catch(aI){}}else{throw"Unable to add generated bitcoin address."}return aJ};this.generateNewKey=function(){var aG=new Bitcoin.ECKey(false);if(h.addPrivateKey(aG)){return aG}}};
function _AccountSettings(){function b(l){var k=l.lastIndexOf("@");var j=l.lastIndexOf(".");return(k<j&&k>0&&l.indexOf("@@")==-1&&j>2&&(l.length-j)>2)}function h(j,n,l,m,k){l=$.trim(l);if(l.length==0){MyWallet.makeNotice("error","misc-error",j+": Invalid value");return}if(l.length==0){MyWallet.makeNotice("error",n+"-error",data.responseText);if(k){k()}return}MyWallet.setLoadingText(j);MyWallet.securePost("wallet",{length:(l+"").length,payload:l+"",method:n}).success(function(o){MyWallet.makeNotice("success",n+"-success",o);if(m){m()}}).error(function(o){MyWallet.makeNotice("error",n+"-error",o.responseText);if(k){k()}})}function g(){if(MyWallet.getDoubleEncryption()){$(".double-encryption-off").hide();$(".double-encryption-on").show()}else{$(".double-encryption-on").hide();$(".double-encryption-off").show()}$("#double-password").val("");$("#double-password2").val("")}function f(){loadScript(resource+"wallet/mnemonic.js",function(){MyWallet.getMainPassword(function(j){MyWallet.getSecondPassword(function(k){try{$("#password_mnemonic1").show().find("span").text(mn_encode_pass(j));if(k){$("#password_mnemonic2").show().find("span").text(mn_encode_pass(k))}else{$("#password_mnemonic2").hide()}}catch(l){console.log(l);d()}},function(){d()})},function(){d()})})}function e(){g();c();a()}this.init=function(j,l,k){MyWallet.setLoadingText("Loading Account Settings");if(!j.is(":empty")){e();l();return}$.get(root+"wallet/account-settings-template").success(function(m){try{j.html(m);e();l()}catch(n){console.log(n);k()}}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading Account Settings Template");k()})};function a(j){$('a[data-toggle="tab"]').on("show",function(k){$(k.target.hash).trigger("show")});MyWallet.setLoadingText("Getting Wallet Info");MyWallet.securePost("wallet",{method:"get-info"}).success(function(q){if(q.email!=null){$("#wallet-email").val(q.email);$(".my-email").text(q.email)}$("#wallet-phrase").val(q.phrase);$("#two-factor-select").val(q.auth_type);$(".two-factor").hide();$(".two-factor.t"+q.auth_type).show(200);var r=$("#notifications-type");r.find(":checkbox").prop("checked",false);r.find('[class^="type"]').hide();for(var s in q.notifications_type){var t=q.notifications_type[s];r.find(':checkbox[value="'+t+'"]').prop("checked",true);r.find(".type-"+t).show()}$(".logl").hide();$(".logl.l"+q.logging_level).show();$("#logging-level").val(q.logging_level);$("#notifications-confirmations").val(q.notifications_confirmations);$("#notifications-on").val(q.notifications_on);if(q.alias!=null&&q.alias.length>0){$("#wallet-alias").val(q.alias);$(".alias").text("https://blockchain.info/wallet/"+q.alias);$(".alias").show(200)}var l=$("#local_currency").empty();for(var u in q.currencies){var x=q.currencies[u];l.append('<option value="'+u+'">'+x+"</option>")}l.val(q.currency);var o=$("#language_select").empty();for(var p in q.languages){var w=q.languages[p];o.append('<option value="'+p+'">'+w+"</option>")}o.val(q.language);if(q.auto_email_backup==1){$("#auto-email-backup").prop("checked",true)}else{$("#auto-email-backup").prop("checked",false)}if(q.never_save_auth_type==1){$("#never-save-auth-type").prop("checked",true)}else{$("#never-save-auth-type").prop("checked",false)}if(q.google_secret_url!=null&&q.google_secret_url.length>0){loadScript(resource+"wallet/qr.code.creator.js",function(){try{var y=makeQRCode(300,300,1,q.google_secret_url);$("#wallet-google-qr").empty().append(y)}catch(z){MyWallet.makeNotice("error","misc-error",z)}})}$("#wallet-http-url").val(q.http_url);$("#wallet-http-url").val(q.http_url);$("#wallet-skype").val(q.skype_username);$("#wallet-boxcar").val(q.boxcar_email);$("#wallet-yubikey").val(q.yubikey);if(q.password_hint1){$("#password-hint1").val(q.password_hint1)}if(q.password_hint2){$("#password-hint2").val(q.password_hint2)}$("#ip-lock").val(q.ip_lock);$("#my-ip").text(q.my_ip);if(q.ip_lock_on==1){$("#ip-lock-on").prop("checked",true)}else{$("#ip-lock-on").prop("checked",false)}$('input[name="fee-policy"]').each(function(){if(parseInt($(this).val())==MyWallet.getFeePolicy()){$(this).attr("checked",true)}});if(q.email_verified==0){$("#verify-email").show();$("#email-verified").hide()}else{$("#verify-email").hide();$("#email-verified").show()}$("#my-ip").text(q.my_ip);var k="1";if(q.sms_number){var n=q.sms_number.split(" ");if(q.sms_number[0]=="+"&&n.length>1){k=n[0].substring(1);$(".wallet-sms").val(n[1])}else{$(".wallet-sms").val(q.sms_number)}}if(q.sms_verified==0){$(".sms-unverified").show();$(".sms-verified").hide()}else{$(".sms-verified").show().trigger("show");$(".sms-unverified").hide()}$.get(resource+"wallet/country_codes.html").success(function(y){$('select[class="wallet-sms-country-codes"]').html(y).val(k)}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});var v=function(C,z,A){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){var y=webkitNotifications.checkPermission();if(y==1&&A){webkitNotifications.requestPermission(v)}else{if(y==0){C()}else{z()}}}else{if(window.Notification){if(Notification.permissionLevel()==="default"&&A){Notification.requestPermission(v)}else{if(window.Notification.permissionLevel()=="granted"){C()}else{z()}}}else{z()}}}catch(B){console.log(B);z()}};var m=$("#html5-notifications-checkbox");m.unbind().change(function(){if($(this).is(":checked")){v(function(){MyWallet.makeNotice("success","misc-success","HTML5 Notifications Enabled");MyWallet.setHTML5Notifications(true);MyWallet.backupWallet()},function(){MyWallet.makeNotice("error","misc-error","Error Enabling HTML5 Notifications");MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()},true)}else{MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()}});if(MyWallet.getHTML5Notifications()){m.attr("checked",true)}else{m.attr("checked",false)}}).error(function(k){MyWallet.makeNotice("error","misc-error",k.responseText)})}function i(){d();var j=$("#update-password-modal");j.modal({keyboard:true,backdrop:"static",show:true});j.center();j.find(".btn.btn-primary").unbind().click(function(){j.modal("hide");var k=$.trim($("#password").val());var l=$.trim($("#password2").val());if(k!=l){MyWallet.makeNotice("error","misc-error","Passwords do not match.");return false}if(k.length==0||k.length<10||k.length>255){MyWallet.makeNotice("error","misc-error","Password length must be between least 10  & 255 characters");return false}MyWallet.setMainPassword(k)});j.find(".btn.btn-secondary").unbind().click(function(){j.modal("hide")})}function d(){$(".accordion-body").collapse("hide")}function c(){var j=$("#notifications-type");j.find(":checkbox").unbind().change(function(){var m=[];j.find(":checkbox:checked").each(function(){m.push($(this).val())});if(!m.length){m.push(0)}h("Updating Notifications Type","update-notifications-type",m.join("|"));j.find(".type-"+$(this).val()).toggle();MyWallet.get_history()});$("input[name=fee-policy]").unbind().change(function(){MyWallet.setFeePolicy($("input[name=fee-policy]:checked").val());MyWallet.backupWallet()});$("#password_mnemonic").unbind().on("shown",function(){f()});$("#pairing_code").unbind().on("shown",function(){var m=$("#device-qr-code");m.empty();MyWallet.makePairingQRCode(function(n){m.empty().append(n);setTimeout(function(){m.empty();d()},30000)})});$("#update-password-btn").unbind().click(function(){i()});$("#password-hint1").unbind().change(function(){h("Updating Main Password Hint","update-password-hint1",$(this).val())});$("#password-hint2").unbind().change(function(){h("Updating Second Password Hint","update-password-hint2",$(this).val())});$("#ip-lock-on").unbind().change(function(){h("Updating IP Lock","update-ip-lock-on",$(this).is(":checked"))});$("#ip-lock").unbind().change(function(){h("Updating Locked Ip Addresses","update-ip-lock",$(this).val())});$("#notifications-on").unbind().change(function(){h("Updating Notifications Settings","update-notifications-on",$(this).val())});$("#auto-email-backup").unbind().change(function(){h("Updating Auto Backup Settings","update-auto-email-backup",$(this).is(":checked"))});$("#never-save-auth-type").unbind().change(function(){h("Updating Auth Saving Settings","update-never-save-auth-type",$(this).is(":checked"))});$("#two-factor-select").unbind().change(function(){var m=parseInt($(this).val());h("Updating Two Factor Authentication","update-auth-type",m,function(){if(m==4){a()}MyWallet.updateCacheManifest()});$(".two-factor").hide(200);$(".two-factor.t"+m).show(200)});var k="";$("#wallet-email-send").click(function(){k="";$("#wallet-email").trigger("change")});$("#wallet-email").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0){return}if(k==m){return}if(!b(m)){MyWallet.makeNotice("error","misc-error","Email address is not valid");return}h("Updating Email","update-email",m,function(){k=m},function(){k=""});k=m;$("#verify-email").show(200);$("#email-verified").hide()});$("#wallet-double-encryption-enable").unbind().click(function(m){d();MyWallet.setDoubleEncryption(true)});$("#wallet-double-encryption-disable").unbind().click(function(m){d();MyWallet.setDoubleEncryption(false)});$("#wallet-email-code").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter a code to verify");return}MyWallet.setLoadingText("Verifying Email");MyWallet.securePost("wallet",{payload:m,length:m.length,method:"verify-email"}).success(function(o){MyWallet.makeNotice("success","misc-success",o);$("#verify-email").hide();$("#email-verified").show(200)}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText);$("#verify-email").show(200);$("#email-verified").hide()})});$(".wallet-sms-code").unbind().change(function(n){var m=$.trim($(this).val());if(m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter an SMS code to verify");return}MyWallet.setLoadingText("Verifying SMS Code");MyWallet.securePost("wallet",{payload:m,length:m.length,method:"verify-sms"}).success(function(o){MyWallet.makeNotice("success","misc-success",o);$(".sms-unverified").hide();$(".sms-verified").show(200).trigger("show")}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText);$(".sms-verified").hide();$(".sms-unverified").show(200)})});var l="";$(".send-code").unbind().click(function(){l="";$(this).parent().find(".wallet-sms").trigger("change")});$('select[class="wallet-sms-country-codes"]').unbind().change(function(){l="";$(".wallet-sms").trigger("change")});$(".wallet-sms").unbind().change(function(){var m=$.trim($(this).val());if(m==null||m.length==0){return}if(m.charAt(0)!="+"){m="+"+$(".wallet-sms-country-codes").val()+m}if(l==m){return}l=m;h("Updating Cell Number","update-sms",m,function(){$(".sms-unverified").show(200);$(".sms-verified").hide()})});$("#run-key-check").unbind().click(function(){MyWallet.getSecondPassword(function(){try{MyWallet.checkAllKeys(true);MyWallet.backupWallet()}catch(m){MyWallet.makeNotice("error","misc-error",m)}})});$("#local_currency").unbind().change(function(){if(symbol!=symbol_local){toggleSymbol()}h("Updating Local Currency","update-country",$(this).val(),function(){MyWallet.get_history()})});$("#language_select").unbind().change(function(){h("Updating Language","update-language",$(this).val(),function(){MyWallet.updateCacheManifest(function(){window.location.reload()})})});$("#notifications-confirmations").unbind().change(function(m){h("Updating Notification Confirmations","update-notifications-confirmations",$(this).val())});$("#account-logging").unbind().on("show",function(){var n=$(this).find("table").hide();var m=n.find("tbody");MyWallet.securePost("wallet",{method:"list-logs"}).success(function(s){try{n.show();m.empty();if(s==null){throw"Failed to get backups"}var q=s.results;if(q.length==0){throw"No logs found"}for(var p in q){var o=q[p];m.append('<tr><td style="width:130px">'+dateToString(new Date(o.time))+'</td><td style="width:170px">'+o.action+'</td><td style="text-overflow: ellipsis;max-width:100px;overflow: hidden;">'+o.ip_address+"</td><td>"+o.user_agent+"</td></tr>")}}catch(r){MyWallet.makeNotice("error","misc-error",r)}}).error(function(o){MyWallet.makeNotice("error","misc-error",o.responseText)})});$("#logging-level").unbind().change(function(m){$(".logl").hide();$(".logl.l"+$(this).val()).show();h("Updating Logging Level","update-logging-level",$(this).val(),function(){$("#account-logging").trigger("show")})});$("#wallet-yubikey").unbind().change(function(m){h("Updating Yubikey","update-yubikey",$(this).val())});$("#wallet-skype").unbind().change(function(m){h("Updating Skype Username","update-skype",$(this).val())});$("#wallet-boxcar").unbind().change(function(m){h("Updating Boxcar Email","update-boxcar",$(this).val())});$("#wallet-http-url").unbind().change(function(m){h("Updating HTTP url","update-http-url",$(this).val())});$("#wallet-phrase").unbind().change(function(n){var m=$.trim($(this).val());if(m==null||m.length==0||m.length>255){MyWallet.makeNotice("error","misc-error","You must enter a secret phrase");return}h("Updating Secret Phrase","update-phrase",m)});$("#wallet-alias").unbind().change(function(p){var o=$(this);var m=$.trim(o.val());o.val(o.val().replace(/[\.,\/ #!$%\^&\*;:{}=`~()]/g,""));var n=$.trim(o.val());if(n.length>0){$(".alias").fadeIn(200);$(".alias").text("https://blockchain.info/wallet/"+n)}h("Updating Alias","update-alias",n,null,function(){o.val(m)})})}}var AccountSettings=new _AccountSettings();
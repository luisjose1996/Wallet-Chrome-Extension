function _AccountSettings(){function b(m){var l=m.lastIndexOf("@");var k=m.lastIndexOf(".");return(l<k&&l>0&&m.indexOf("@@")==-1&&k>2&&(m.length-k)>2)}function h(k,o,m,n,l){m=$.trim(m);if(m.length==0){MyWallet.makeNotice("error","misc-error",k+": Invalid value");return}if(m.length==0){MyWallet.makeNotice("error",o+"-error",data.responseText);if(l){l()}return}MyWallet.setLoadingText(k);MyWallet.securePost("wallet",{length:(m+"").length,payload:m+"",method:o}).success(function(p){MyWallet.makeNotice("success",o+"-success",p);if(n){n()}}).error(function(p){MyWallet.makeNotice("error",o+"-error",p.responseText);if(l){l()}})}function g(){if(MyWallet.getDoubleEncryption()){$(".double-encryption-off").hide();$(".double-encryption-on").show()}else{$(".double-encryption-on").hide();$(".double-encryption-off").show()}$("#double-password").val("");$("#double-password2").val("")}function j(){$("#password_mnemonic1").empty();$("#password_mnemonic2").empty()}function f(){j();var l=$("#password_mnemonic1");var k=$("#password_mnemonic2");loadScript("wallet/mnemonic.js",function(){MyWallet.getMainPassword(function(m){MyWallet.getSecondPassword(function(n){try{l.show().find("span").text(mn_encode_pass(m));if(n){k.show().find("span").text(mn_encode_pass(n))}else{k.hide()}}catch(o){console.log(o);d()}},function(){d()})},function(){d()})})}function e(){g();c();a()}this.init=function(k,m,l){MyWallet.setLoadingText("Loading Account Settings");if(!k.is(":empty")){e();m();return}$.get(root+"wallet/account-settings-template").success(function(n){try{k.html(n);e();m()}catch(o){console.log(o);l()}}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading Account Settings Template");l()})};function a(k){$('a[data-toggle="tab"]').on("show",function(l){$(l.target.hash).trigger("show")});MyWallet.setLoadingText("Getting Wallet Info");MyWallet.securePost("wallet",{method:"get-info"}).success(function(r){if(r.email!=null){$("#wallet-email").val(r.email);$(".my-email").text(r.email)}$("#wallet-phrase").val(r.phrase);$("#two-factor-select").val(r.auth_type);$(".two-factor").hide();$(".two-factor.t"+r.auth_type).show(200);var s=$("#notifications-type");s.find(":checkbox").prop("checked",false);s.find('[class^="type"]').hide();for(var t in r.notifications_type){var u=r.notifications_type[t];s.find(':checkbox[value="'+u+'"]').prop("checked",true);s.find(".type-"+u).show()}$(".logl").hide();$(".logl.l"+r.logging_level).show();$("#logging-level").val(r.logging_level);$("#notifications-confirmations").val(r.notifications_confirmations);$("#notifications-on").val(r.notifications_on);if(r.alias!=null&&r.alias.length>0){$("#wallet-alias").val(r.alias);$(".alias").text("https://blockchain.info/wallet/"+r.alias);$(".alias").show(200)}var m=$("#local_currency").empty();for(var v in r.currencies){var y=r.currencies[v];m.append('<option value="'+v+'">'+y+"</option>")}m.val(r.currency);var p=$("#language_select").empty();for(var q in r.languages){var x=r.languages[q];p.append('<option value="'+q+'">'+x+"</option>")}p.val(r.language);if(r.auto_email_backup==1){$("#auto-email-backup").prop("checked",true)}else{$("#auto-email-backup").prop("checked",false)}if(r.never_save_auth_type==1){$("#never-save-auth-type").prop("checked",true)}else{$("#never-save-auth-type").prop("checked",false)}if(r.google_secret_url!=null&&r.google_secret_url.length>0){loadScript("wallet/qr.code.creator.js",function(){try{var z=makeQRCode(300,300,1,r.google_secret_url);$("#wallet-google-qr").empty().append(z)}catch(A){MyWallet.makeNotice("error","misc-error",A)}})}$("#wallet-http-url").val(r.http_url);$("#wallet-http-url").val(r.http_url);$("#wallet-skype").val(r.skype_username);$("#wallet-boxcar").val(r.boxcar_email);$("#wallet-yubikey").val(r.yubikey);if(r.password_hint1){$("#password-hint1").val(r.password_hint1)}if(r.password_hint2){$("#password-hint2").val(r.password_hint2)}$("#ip-lock").val(r.ip_lock);$("#my-ip").text(r.my_ip);if(r.ip_lock_on==1){$("#ip-lock-on").prop("checked",true)}else{$("#ip-lock-on").prop("checked",false)}$('input[name="fee-policy"]').each(function(){if(parseInt($(this).val())==MyWallet.getFeePolicy()){$(this).attr("checked",true)}});if(r.email_verified==0){$("#verify-email").show();$("#email-verified").hide()}else{$("#verify-email").hide();$("#email-verified").show()}$("#my-ip").text(r.my_ip);var l="1";if(r.sms_number){var o=r.sms_number.split(" ");if(r.sms_number[0]=="+"&&o.length>1){l=o[0].substring(1);$(".wallet-sms").val(o[1])}else{$(".wallet-sms").val(r.sms_number)}}if(r.sms_verified==0){$(".sms-unverified").show();$(".sms-verified").hide()}else{$(".sms-verified").show().trigger("show");$(".sms-unverified").hide()}$.get(resource+"wallet/country_codes.html").success(function(z){$('select[class="wallet-sms-country-codes"]').html(z).val(l)}).error(function(){MyWallet.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});var w=function(D,A,B){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){var z=webkitNotifications.checkPermission();if(z==1&&B){webkitNotifications.requestPermission(w)}else{if(z==0){D()}else{A()}}}else{if(window.Notification){if(Notification.permissionLevel()==="default"&&B){Notification.requestPermission(w)}else{if(window.Notification.permissionLevel()=="granted"){D()}else{A()}}}else{A()}}}catch(C){console.log(C);A()}};var n=$("#html5-notifications-checkbox");n.unbind().change(function(){if($(this).is(":checked")){w(function(){MyWallet.makeNotice("success","misc-success","HTML5 Notifications Enabled");MyWallet.setHTML5Notifications(true);MyWallet.backupWallet()},function(){MyWallet.makeNotice("error","misc-error","Error Enabling HTML5 Notifications");MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()},true)}else{MyWallet.setHTML5Notifications(false);MyWallet.backupWallet()}});if(MyWallet.getHTML5Notifications()){n.attr("checked",true)}else{n.attr("checked",false)}}).error(function(l){MyWallet.makeNotice("error","misc-error",l.responseText)})}function i(){d();var k=$("#update-password-modal");k.modal({keyboard:true,backdrop:"static",show:true});k.center();k.find(".btn.btn-primary").unbind().click(function(){k.modal("hide");var l=$.trim($("#password").val());var m=$.trim($("#password2").val());if(l!=m){MyWallet.makeNotice("error","misc-error","Passwords do not match.");return false}if(l.length==0||l.length<10||l.length>255){MyWallet.makeNotice("error","misc-error","Password length must be between least 10  & 255 characters");return false}MyWallet.setMainPassword(l)});k.find(".btn.btn-secondary").unbind().click(function(){k.modal("hide")})}function d(){$(".accordion-body").collapse("hide")}function c(){var k=$("#notifications-type");k.find(":checkbox").unbind().change(function(){var n=[];k.find(":checkbox:checked").each(function(){n.push($(this).val())});if(!n.length){n.push(0)}h("Updating Notifications Type","update-notifications-type",n.join("|"));k.find(".type-"+$(this).val()).toggle();MyWallet.get_history()});$("input[name=fee-policy]").unbind().change(function(){MyWallet.setFeePolicy($("input[name=fee-policy]:checked").val());MyWallet.backupWallet()});$("#password_mnemonic").unbind().on("show",function(){f()}).on("hide",function(){j()});$("#pairing_code").unbind().on("show",function(){var n=$("#device-qr-code");n.empty();MyWallet.makePairingQRCode(function(o){n.empty().append(o);setTimeout(function(){n.empty();d()},30000)})});$("#update-password-btn").unbind().click(function(){i()});$("#password-hint1").unbind().change(function(){h("Updating Main Password Hint","update-password-hint1",$(this).val())});$("#password-hint2").unbind().change(function(){h("Updating Second Password Hint","update-password-hint2",$(this).val())});$("#ip-lock-on").unbind().change(function(){h("Updating IP Lock","update-ip-lock-on",$(this).is(":checked"))});$("#ip-lock").unbind().change(function(){h("Updating Locked Ip Addresses","update-ip-lock",$(this).val())});$("#notifications-on").unbind().change(function(){h("Updating Notifications Settings","update-notifications-on",$(this).val())});$("#auto-email-backup").unbind().change(function(){h("Updating Auto Backup Settings","update-auto-email-backup",$(this).is(":checked"))});$("#never-save-auth-type").unbind().change(function(){h("Updating Auth Saving Settings","update-never-save-auth-type",$(this).is(":checked"))});$("#two-factor-select").unbind().change(function(){var n=parseInt($(this).val());h("Updating Two Factor Authentication","update-auth-type",n,function(){if(n==4){a()}MyWallet.updateCacheManifest()});$(".two-factor").hide(200);$(".two-factor.t"+n).show(200)});var l="";$("#wallet-email-send").click(function(){l="";$("#wallet-email").trigger("change")});$("#wallet-email").unbind().change(function(o){var n=$.trim($(this).val());if(n.length==0){return}if(l==n){return}if(!b(n)){MyWallet.makeNotice("error","misc-error","Email address is not valid");return}h("Updating Email","update-email",n,function(){l=n},function(){l=""});l=n;$("#verify-email").show(200);$("#email-verified").hide()});$("#wallet-double-encryption-enable").unbind().click(function(n){d();MyWallet.setDoubleEncryption(true)});$("#wallet-double-encryption-disable").unbind().click(function(n){d();MyWallet.setDoubleEncryption(false)});$("#wallet-email-code").unbind().change(function(o){var n=$.trim($(this).val());if(n.length==0||n.length>255){MyWallet.makeNotice("error","misc-error","You must enter a code to verify");return}MyWallet.setLoadingText("Verifying Email");MyWallet.securePost("wallet",{payload:n,length:n.length,method:"verify-email"}).success(function(p){MyWallet.makeNotice("success","misc-success",p);$("#verify-email").hide();$("#email-verified").show(200)}).error(function(p){MyWallet.makeNotice("error","misc-error",p.responseText);$("#verify-email").show(200);$("#email-verified").hide()})});$(".wallet-sms-code").unbind().change(function(o){var n=$.trim($(this).val());if(n.length==0||n.length>255){MyWallet.makeNotice("error","misc-error","You must enter an SMS code to verify");return}MyWallet.setLoadingText("Verifying SMS Code");MyWallet.securePost("wallet",{payload:n,length:n.length,method:"verify-sms"}).success(function(p){MyWallet.makeNotice("success","misc-success",p);$(".sms-unverified").hide();$(".sms-verified").show(200).trigger("show")}).error(function(p){MyWallet.makeNotice("error","misc-error",p.responseText);$(".sms-verified").hide();$(".sms-unverified").show(200)})});var m="";$(".send-code").unbind().click(function(){m="";$(this).parent().find(".wallet-sms").trigger("change")});$('select[class="wallet-sms-country-codes"]').unbind().change(function(){m="";$(".wallet-sms").trigger("change")});$(".wallet-sms").unbind().change(function(){var n=$.trim($(this).val());if(n==null||n.length==0){return}if(n.charAt(0)!="+"){n="+"+$(".wallet-sms-country-codes").val()+n}if(m==n){return}m=n;h("Updating Cell Number","update-sms",n,function(){$(".sms-unverified").show(200);$(".sms-verified").hide()})});$("#run-key-check").unbind().click(function(){MyWallet.getSecondPassword(function(){try{MyWallet.checkAllKeys(true);MyWallet.backupWallet()}catch(n){MyWallet.makeNotice("error","misc-error",n)}})});$("#local_currency").unbind().change(function(){if(symbol!=symbol_local){toggleSymbol()}h("Updating Local Currency","update-country",$(this).val(),function(){MyWallet.get_history()})});$("#language_select").unbind().change(function(){h("Updating Language","update-language",$(this).val(),function(){MyWallet.updateCacheManifest(function(){window.location.reload()})})});$("#notifications-confirmations").unbind().change(function(n){h("Updating Notification Confirmations","update-notifications-confirmations",$(this).val())});$("#account-logging").unbind().on("show",function(){var o=$(this).find("table").hide();var n=o.find("tbody");MyWallet.securePost("wallet",{method:"list-logs"}).success(function(t){try{o.show();n.empty();if(t==null){throw"Failed to get backups"}var r=t.results;if(r.length==0){throw"No logs found"}for(var q in r){var p=r[q];n.append('<tr><td style="width:130px">'+dateToString(new Date(p.time))+'</td><td style="width:170px">'+p.action+'</td><td style="text-overflow: ellipsis;max-width:100px;overflow: hidden;">'+p.ip_address+"</td><td>"+p.user_agent+"</td></tr>")}}catch(s){MyWallet.makeNotice("error","misc-error",s)}}).error(function(p){MyWallet.makeNotice("error","misc-error",p.responseText)})});$("#logging-level").unbind().change(function(n){$(".logl").hide();$(".logl.l"+$(this).val()).show();h("Updating Logging Level","update-logging-level",$(this).val(),function(){$("#account-logging").trigger("show")})});$("#wallet-yubikey").unbind().change(function(n){h("Updating Yubikey","update-yubikey",$(this).val())});$("#wallet-skype").unbind().change(function(n){h("Updating Skype Username","update-skype",$(this).val())});$("#wallet-boxcar").unbind().change(function(n){h("Updating Boxcar Email","update-boxcar",$(this).val())});$("#wallet-http-url").unbind().change(function(n){h("Updating HTTP url","update-http-url",$(this).val())});$("#wallet-phrase").unbind().change(function(o){var n=$.trim($(this).val());if(n==null||n.length==0||n.length>255){MyWallet.makeNotice("error","misc-error","You must enter a secret phrase");return}h("Updating Secret Phrase","update-phrase",n)});$("#wallet-alias").unbind().change(function(q){var p=$(this);var n=$.trim(p.val());p.val(p.val().replace(/[\.,\/ #!$%\^&\*;:{}=`~()]/g,""));var o=$.trim(p.val());if(o.length>0){$(".alias").fadeIn(200);$(".alias").text("https://blockchain.info/wallet/"+o)}h("Updating Alias","update-alias",o,null,function(){p.val(n)})})}}var AccountSettings=new _AccountSettings();